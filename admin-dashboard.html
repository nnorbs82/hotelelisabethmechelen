<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hotel Elisabeth Mechelen</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="admin-page">
    <header class="admin-header">
        <nav class="admin-top-nav">
            <button class="menu-trigger-btn" id="menu-trigger-btn">MENU</button>
            <h1>Admin Dashboard</h1>
            <button id="logout-btn" class="btn nav-btn btn-logout" aria-label="Logout from admin dashboard">LOG OUT</button>
        </nav>
    </header>

    <!-- Vertical Sidebar Menu -->
    <aside class="vertical-menu" id="vertical-menu">
        <nav class="vertical-menu-nav">
            <ul class="vertical-menu-list">
                <li class="vertical-menu-item has-submenu">
                    <button class="vertical-menu-btn" data-menu="update-index">
                        <span>Update Index</span>
                        <span class="arrow">â€º</span>
                    </button>
                    <div class="vertical-submenu" id="submenu-update-index">
                        <button class="submenu-item" id="main-banner-btn">Main Banner</button>
                        <button class="submenu-item" id="ads-btn">Index Ads</button>
                        <button class="submenu-item" id="ads-bottom-btn">Ads Bottom</button>
                        <button class="submenu-item" id="about-us-btn">About Us</button>
                    </div>
                </li>
                <li class="vertical-menu-item">
                    <button class="vertical-menu-btn" id="manage-rooms-btn">
                        <span>Manage Rooms</span>
                    </button>
                </li>
                <li class="vertical-menu-item">
                    <button class="vertical-menu-btn" id="manage-packages-btn">
                        <span>Manage Packages</span>
                    </button>
                </li>
                <li class="vertical-menu-item">
                    <button class="vertical-menu-btn" id="view-bookings-btn">
                        <span>View Bookings</span>
                    </button>
                </li>
                <li class="vertical-menu-item">
                    <button class="vertical-menu-btn" id="set-amenities-btn">
                        <span>Set Room Amenities</span>
                    </button>
                </li>
                <li class="vertical-menu-item">
                    <button class="vertical-menu-btn" id="manage-facilities-btn">
                        <span>Manage Facilities</span>
                    </button>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="container">
        <div id="loading" style="text-align: center; padding: 3rem;">
            <p>Loading...</p>
        </div>
        
        <div id="dashboard-content" style="display: none;">
            <!-- Photo Management Card -->
            <div id="photo-management-card" class="card" style="display: none;">
                <h2>Main Banner Photo Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Upload and manage photos for the main banner. Drag and drop photos to reorder them.</p>
                
                <div class="photo-upload-section">
                    <input type="file" id="photo-upload-input" accept="image/*" style="display: none;">
                    <button class="btn" id="add-photo-btn">Add Photo</button>
                </div>

                <div id="photo-grid" class="photo-grid">
                    <!-- Photos will be dynamically added here -->
                </div>
                
                <!-- Background Photo Section -->
                <div id="background-photo-section">
                    <h3>Background Photo</h3>
                    <p style="color: var(--color-sage);">Upload a background image for the website pages.</p>
                    
                    <input type="file" id="background-upload-input" accept="image/*" style="display: none;">
                    <button class="btn" id="add-background-btn">Upload Background</button>
                    
                    <div id="background-preview" style="margin-top: 1rem;">
                        <!-- Image preview will be displayed here with consistent size -->
                    </div>
                </div>
            </div>

            <!-- Index Ads Management Card -->
            <div id="ads-management-card" class="card" style="display: none;">
                <h2>Index Ads Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Manage the three promotional ads displayed on the index page.</p>
                
                <!-- Tab Navigation -->
                <div class="ads-tabs">
                    <button class="ads-tab active" data-ad="ad1">Ad Item 1</button>
                    <button class="ads-tab" data-ad="ad2">Ad Item 2</button>
                    <button class="ads-tab" data-ad="ad3">Ad Item 3</button>
                </div>
                
                <!-- Tab Content -->
                <div id="ads-tab-content">
                    <!-- Content will be rendered by JavaScript -->
                </div>
            </div>

            <!-- About Us Management Card -->
            <div id="about-us-management-card" class="card" style="display: none;">
                <h2>About Us Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Manage the About Us section content displayed on the index page.</p>
                
                <!-- Tab Navigation -->
                <div class="about-us-tabs">
                    <button class="about-us-tab active" data-tab="title">About Us Title</button>
                    <button class="about-us-tab" data-tab="left">About Us Left</button>
                    <button class="about-us-tab" data-tab="right">About Us Right</button>
                </div>
                
                <!-- Tab Content -->
                <div id="about-us-tab-content">
                    <!-- Content will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Ads Bottom Management Card -->
            <div id="ads-bottom-management-card" class="card" style="display: none;">
                <h2>Ads Bottom Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Manage the three promotional ads displayed at the bottom of the index page.</p>
                
                <!-- Tab Navigation -->
                <div class="ads-bottom-tabs">
                    <button class="ads-bottom-tab active" data-tab="titles">Titles</button>
                    <button class="ads-bottom-tab" data-tab="ad1">Ad 1</button>
                    <button class="ads-bottom-tab" data-tab="ad2">Ad 2</button>
                    <button class="ads-bottom-tab" data-tab="ad3">Ad 3</button>
                </div>
                
                <!-- Tab Content -->
                <div id="ads-bottom-tab-content">
                    <!-- Content will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Amenities Management Card -->
            <div id="amenities-management-card" class="card" style="display: none;">
                <h2>Room Amenities Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1.5rem;">Manage the master list of room amenities. These can be assigned to individual rooms.</p>
                
                <!-- Add New Amenity Section -->
                <div class="amenity-add-section">
                    <h3>Add New Amenity</h3>
                    
                    <!-- Language Tabs -->
                    <div class="lang-tabs">
                        <button class="lang-tab active" data-lang="en">English</button>
                        <button class="lang-tab" data-lang="nl">Nederlands</button>
                        <button class="lang-tab" data-lang="fr">FranÃ§ais</button>
                    </div>
                    
                    <div class="form-group">
                        <label id="amenity-name-label">Amenity Name (English)</label>
                        <input type="text" id="amenity-name-input" class="form-control" placeholder="e.g., Free Wi-Fi">
                    </div>
                    
                    <button class="btn" id="add-amenity-btn">Add Amenity</button>
                </div>
                
                <!-- Existing Amenities List -->
                <div class="amenities-list-section">
                    <h3>Existing Amenities</h3>
                    <div id="amenities-list" class="amenities-grid">
                        <!-- Amenities will be dynamically loaded here -->
                    </div>
                </div>
            </div>

            <!-- Room Management Card -->
            <div id="room-management-card" class="card" style="display: none;">
                <h2>Room Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Create, edit, delete, and manage hotel rooms.</p>
                
                <!-- Add New Room Button -->
                <div style="margin: 1rem 0;">
                    <button class="btn" id="add-new-room-btn">Add New Room</button>
                </div>
                
                <!-- Room List Container -->
                <div id="room-list-container">
                    <!-- Rooms will be rendered here -->
                </div>
            </div>

            <!-- Package Management Card -->
            <div id="package-management-card" class="card" style="display: none;">
                <h2>Package Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Create, edit, delete, and reorder hotel packages.</p>
                
                <!-- Tab Navigation for Active/Inactive -->
                <div class="package-tabs">
                    <button class="package-tab active" data-status="active">Active Packages</button>
                    <button class="package-tab" data-status="inactive">Inactive Packages</button>
                </div>
                
                <!-- Add New Package Button -->
                <div style="margin: 1rem 0;">
                    <button class="btn" id="add-package-btn">Add New Package</button>
                </div>
                
                <!-- Package List Container -->
                <div id="package-list-container">
                    <!-- Packages will be rendered here -->
                </div>
            </div>

            <!-- Facilities Management Card -->
            <div id="facilities-management-card" class="card" style="display: none;">
                <h2>Facilities Management</h2>
                <p style="color: var(--color-sage); margin-bottom: 1rem;">Create and manage facilities content, guidelines, and imagery for the facilities page.</p>

                <div class="facility-add-section">
                    <h3>Add New Facility</h3>
                    <div class="facility-lang-tabs">
                        <button class="facility-lang-tab active" data-lang="en">English</button>
                        <button class="facility-lang-tab" data-lang="nl">Nederlands</button>
                        <button class="facility-lang-tab" data-lang="fr">FranÃ§ais</button>
                    </div>

                    <div class="form-group">
                        <label id="facility-name-label">Facility Name (English)</label>
                        <input type="text" id="facility-name-input" class="form-control" placeholder="e.g., Wellness & Spa">
                    </div>
                    <div class="form-group">
                        <label id="facility-operation-label">Operation & Description (English)</label>
                        <textarea id="facility-operation-input" class="admin-textarea" placeholder="Enter operation details and description"></textarea>
                    </div>
                    <div class="form-group">
                        <label id="facility-guidelines-label">Guidelines (English) - one per line</label>
                        <textarea id="facility-guidelines-input" class="admin-textarea" placeholder="Enter guidelines, one per line"></textarea>
                    </div>

                    <button class="btn" id="add-facility-btn">Add Facility</button>
                </div>

                <div class="facility-main-image-section">
                    <h3>Main Facilities Hero Image</h3>
                    <p style="color: var(--color-sage); margin-bottom: 0.5rem;">Upload the hero image displayed on the facilities page.</p>
                    <input type="file" id="facility-hero-upload-input" accept="image/*" style="display: none;">
                    <button class="btn" id="upload-facility-hero-btn">Upload Main Image</button>
                    <div id="facility-hero-preview" class="facility-hero-preview"></div>
                </div>

                <div class="facility-library-section">
                    <h3>Facilities Photo Library</h3>
                    <p style="color: var(--color-sage); margin-bottom: 0.5rem;">Upload and reorder photos for each facility on the facilities page.</p>
                    <div class="form-group">
                        <label for="facility-library-select">Select facility album</label>
                        <select id="facility-library-select" class="form-control"></select>
                    </div>
                    <input type="file" id="facility-library-input" accept="image/*" multiple style="display: none;">
                    <button class="btn" id="upload-facility-library-btn">Add Library Photos</button>
                    <div id="facility-library-grid" class="photo-grid"></div>
                </div>

                <div class="facility-list-section">
                    <h3>Existing Facilities</h3>
                    <div id="facility-list" class="facility-grid"></div>
                </div>
            </div>

        </div>
    </main>

    <footer>
        <p>&copy; 2026 Hotel Elisabeth Mechelen. All rights reserved.</p>
    </footer>

    <!-- Vertical Menu Interaction (non-module script to ensure it runs independently) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ============ VERTICAL MENU INTERACTION - FIXED ============
            const menuTriggerBtn = document.getElementById('menu-trigger-btn');
            const verticalMenu = document.getElementById('vertical-menu');
            let menuTimeout = null;

            // Show menu on MENU button hover
            menuTriggerBtn.addEventListener('mouseenter', () => {
                clearTimeout(menuTimeout);
                verticalMenu.classList.add('show');
            });

            menuTriggerBtn.addEventListener('mouseleave', () => {
                menuTimeout = setTimeout(() => {
                    if (!isHoveringMenu()) {
                        verticalMenu.classList.remove('show');
                    }
                }, 200);
            });

            // Keep menu visible when hovering menu or submenus
            verticalMenu.addEventListener('mouseenter', () => {
                clearTimeout(menuTimeout);
            });

            verticalMenu.addEventListener('mouseleave', () => {
                menuTimeout = setTimeout(() => {
                    verticalMenu.classList.remove('show');
                }, 300);
            });

            // Check if mouse is over menu or any submenu
            function isHoveringMenu() {
                return verticalMenu.matches(':hover') || 
                       document.querySelector('.vertical-submenu:hover') !== null;
            }

            // Handle submenu hover - keep parent and submenu visible
            document.querySelectorAll('.vertical-menu-item.has-submenu').forEach(item => {
                const submenu = item.querySelector('.vertical-submenu');
                const menuBtn = item.querySelector('.vertical-menu-btn');
                
                if (submenu && menuBtn) {
                    // Position submenu on hover
                    // Note: getBoundingClientRect() triggers layout reflow, but this is acceptable
                    // since it only happens once per mouseenter event (not continuous)
                    const positionSubmenu = () => {
                        const rect = menuBtn.getBoundingClientRect();
                        const menuRect = verticalMenu.getBoundingClientRect();
                        // Align submenu top edge with button top edge
                        // Since submenu is position:fixed inside a transformed parent (.vertical-menu),
                        // it's positioned relative to that parent, not the viewport
                        // So we subtract the parent menu's top position to get the correct offset
                        submenu.style.top = (rect.top - menuRect.top) + 'px';
                    };
                    
                    // Position on mouse enter
                    item.addEventListener('mouseenter', () => {
                        positionSubmenu();
                    });
                    
                    // When hovering submenu, keep everything visible
                    submenu.addEventListener('mouseenter', () => {
                        clearTimeout(menuTimeout);
                        item.classList.add('active');
                    });
                    
                    submenu.addEventListener('mouseleave', () => {
                        item.classList.remove('active');
                        menuTimeout = setTimeout(() => {
                            if (!isHoveringMenu()) {
                                verticalMenu.classList.remove('show');
                            }
                        }, 300);
                    });
                }
            });

            // Close menu when clicking any menu item
            document.querySelectorAll('.submenu-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    verticalMenu.classList.remove('show');
                });
            });
            
            document.querySelectorAll('.vertical-menu-item:not(.has-submenu) .vertical-menu-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    verticalMenu.classList.remove('show');
                });
            });
        });
    </script>

    <!-- Firebase SDK and Authentication Check -->
    <script type="module">
        import { checkAuthState, logoutAdmin } from './auth.js';
        import { storage, database } from './firebase-config.js';
        import { ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
        import { ref as dbRef, set, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        let currentPhotos = [];

        // Check if user is authenticated
        checkAuthState((authState) => {
            const loading = document.getElementById('loading');
            const dashboardContent = document.getElementById('dashboard-content');
            
            if (authState.authenticated) {
                // User is logged in, show dashboard
                loading.style.display = 'none';
                dashboardContent.style.display = 'block';
                
                // Display admin email
                const adminEmailElement = document.getElementById('admin-email');
                if (adminEmailElement) {
                    adminEmailElement.textContent = `Logged in as: ${authState.user.email}`;
                }
            } else {
                // User is not logged in, redirect to login page
                window.location.href = 'hoteladmin.html';
            }
        });

        // Handle logout
        document.getElementById('logout-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            const result = await logoutAdmin();
            if (result.success) {
                window.location.href = 'hoteladmin.html';
            }
        });

        // Helper function to ensure dashboard content is visible
        function ensureDashboardVisible() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard-content').style.display = 'block';
        }

        // Show photo management card when Main Banner is clicked
        document.getElementById('main-banner-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            // Hide all cards
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            
            // Show only photo card
            photoCard.style.display = 'block';
            photoCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadPhotos();
            await loadBackgroundPhoto();
        });

        // Show ads management card when Ads is clicked
        document.getElementById('ads-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            // Hide all cards
            photoCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            
            // Show only ads card
            adsCard.style.display = 'block';
            adsCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadAds();
        });

        // Add photo button
        document.getElementById('add-photo-btn').addEventListener('click', () => {
            document.getElementById('photo-upload-input').click();
        });

        // Handle photo upload
        document.getElementById('photo-upload-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            const addBtn = document.getElementById('add-photo-btn');
            addBtn.disabled = true;
            addBtn.textContent = 'Uploading...';

            try {
                // Generate unique filename
                const timestamp = Date.now();
                const filename = `main-banner/${timestamp}-${file.name}`;
                const fileRef = storageRef(storage, filename);

                // Upload file
                await uploadBytes(fileRef, file);
                const downloadURL = await getDownloadURL(fileRef);

                // Save to database
                const photoData = {
                    url: downloadURL,
                    filename: filename,
                    timestamp: timestamp,
                    order: currentPhotos.length
                };

                await set(dbRef(database, `mainBanner/${timestamp}`), photoData);

                // Reload photos
                await loadPhotos();

                // Reset input
                e.target.value = '';
            } catch (error) {
                console.error('Error uploading photo:', error);
                alert('Failed to upload photo. Please try again.');
            } finally {
                addBtn.disabled = false;
                addBtn.textContent = 'Add Photo';
            }
        });

        // Load photos from database
        async function loadPhotos() {
            try {
                const snapshot = await get(dbRef(database, 'mainBanner'));
                currentPhotos = [];

                if (snapshot.exists()) {
                    const data = snapshot.val();
                    currentPhotos = Object.values(data).sort((a, b) => a.order - b.order);
                }

                renderPhotos();
            } catch (error) {
                console.error('Error loading photos:', error);
            }
        }

        // Render photos in the grid
        function renderPhotos() {
            const grid = document.getElementById('photo-grid');
            grid.innerHTML = '';

            if (currentPhotos.length === 0) {
                grid.innerHTML = '<p style="color: var(--color-sage);">No photos uploaded yet. Click "Add Photo" to get started.</p>';
                return;
            }

            currentPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.draggable = true;
                photoItem.dataset.index = index;
                
                photoItem.innerHTML = `
                    <img src="${photo.url}" alt="Banner photo ${index + 1}">
                    <div class="photo-overlay">
                        <button class="btn-delete" onclick="deletePhoto(${index})">Delete</button>
                    </div>
                `;
                
                // Add drag event listeners
                photoItem.addEventListener('dragstart', handleDragStart);
                photoItem.addEventListener('dragover', handleDragOver);
                photoItem.addEventListener('drop', handleDrop);
                photoItem.addEventListener('dragend', handleDragEnd);
                
                grid.appendChild(photoItem);
            });
        }

        // Drag and drop event handlers
        let draggedIndex = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.currentTarget.dataset.index);
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            draggedIndex = null; // Reset to ensure cleanup
            // Remove drag-over class from all items
            document.querySelectorAll('.photo-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            // Only remove drag-over if we're actually leaving the element
            // Check that relatedTarget is a valid DOM element before using contains
            if (!e.relatedTarget || 
                (e.relatedTarget instanceof Node && !e.currentTarget.contains(e.relatedTarget))) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        async function handleDrop(e) {
            e.stopPropagation();
            e.preventDefault();

            const dropIndex = parseInt(e.currentTarget.dataset.index);
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                await reorderPhotos(draggedIndex, dropIndex);
            }
        }

        // Reorder photos based on drag and drop
        async function reorderPhotos(fromIndex, toIndex) {
            try {
                // Create a new array with reordered photos
                const reorderedPhotos = [...currentPhotos];
                const [movedPhoto] = reorderedPhotos.splice(fromIndex, 1);
                reorderedPhotos.splice(toIndex, 0, movedPhoto);

                // Update order values first
                reorderedPhotos.forEach((photo, i) => {
                    photo.order = i;
                });

                // Prepare all database updates
                const updates = reorderedPhotos.map((photo) => {
                    return set(dbRef(database, `mainBanner/${photo.timestamp}`), photo);
                });

                // Execute all updates in parallel
                await Promise.all(updates);

                // Reload photos
                await loadPhotos();
            } catch (error) {
                console.error('Error reordering photos:', error);
                alert('Failed to reorder photos. Please try again.');
            }
        }

        // Add delete photo function
        async function deletePhoto(index) {
            if (!confirm('Are you sure you want to delete this photo?')) {
                return;
            }
            
            try {
                // Bounds check for index
                if (index < 0 || index >= currentPhotos.length) {
                    console.error('Invalid index:', index);
                    alert('Invalid photo index.');
                    return;
                }
                
                const photo = currentPhotos[index];
                
                // Delete from storage
                if (photo.filename) {
                    const fileRef = storageRef(storage, photo.filename);
                    await deleteObject(fileRef);
                }
                
                // Delete from database
                await remove(dbRef(database, `mainBanner/${photo.timestamp}`));
                
                // Reload photos
                await loadPhotos();
                
                alert('Photo deleted successfully!');
            } catch (error) {
                console.error('Error deleting photo:', error);
                alert('Failed to delete photo. Please try again.');
            }
        }
        
        // Make deletePhoto globally accessible
        window.deletePhoto = deletePhoto;

        // Reindex photos after deletion
        async function reindexPhotos() {
            try {
                // Update order values first
                currentPhotos.forEach((photo, i) => {
                    photo.order = i;
                });

                // Prepare all database updates
                const updates = currentPhotos.map((photo) => {
                    return set(dbRef(database, `mainBanner/${photo.timestamp}`), photo);
                });
                
                // Execute all updates in parallel
                await Promise.all(updates);
            } catch (error) {
                console.error('Error reindexing photos:', error);
            }
        }

        // ============ INDEX ADS MANAGEMENT (REFACTORED WITH TABS) ============
        const languages = ['en', 'nl', 'fr'];
        const languageLabels = {
            en: { name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
            nl: { name: 'Dutch', flag: 'ðŸ‡³ðŸ‡±' },
            fr: { name: 'French', flag: 'ðŸ‡«ðŸ‡·' }
        };

        let adsData = {
            ad1: { imageUrl: '', topText_en: '', topText_nl: '', topText_fr: '', bottomText_en: '', bottomText_nl: '', bottomText_fr: '', buttonTitle_en: '', buttonTitle_nl: '', buttonTitle_fr: '', link: '' },
            ad2: { imageUrl: '', topText_en: '', topText_nl: '', topText_fr: '', bottomText_en: '', bottomText_nl: '', bottomText_fr: '', buttonTitle_en: '', buttonTitle_nl: '', buttonTitle_fr: '', link: '' },
            ad3: { imageUrl: '', topText_en: '', topText_nl: '', topText_fr: '', bottomText_en: '', bottomText_nl: '', bottomText_fr: '', buttonTitle_en: '', buttonTitle_nl: '', buttonTitle_fr: '', link: '' }
        };

        let currentAdTab = 'ad1';
        let currentAdLang = 'en';

        // Escape HTML to prevent XSS in attributes
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Validate and sanitize image URLs
        function sanitizeImageUrl(url) {
            if (!url) return '';
            const trimmed = url.trim();
            // Only allow HTTPS URLs from Firebase Storage
            if (trimmed.startsWith('https://firebasestorage.googleapis.com/') || 
                trimmed.startsWith('https://storage.googleapis.com/')) {
                return escapeHtml(trimmed);
            }
            return '';
        }

        // Tab switching for ads
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('ads-tab')) {
                document.querySelectorAll('.ads-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAdTab = e.target.dataset.ad;
                renderAdTab();
            }
            
            if (e.target.classList.contains('ads-lang-tab')) {
                document.querySelectorAll('.ads-lang-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAdLang = e.target.dataset.lang;
                renderAdTab();
            }
        });

        // Load ads data
        async function loadAds() {
            try {
                const snapshot = await get(dbRef(database, 'indexAds'));
                
                if (snapshot.exists()) {
                    adsData = snapshot.val();
                }
                
                renderAdTab();
            } catch (error) {
                console.error('Error loading ads:', error);
            }
        }

        // Render ad tab content
        function renderAdTab() {
            const container = document.getElementById('ads-tab-content');
            const ad = adsData[currentAdTab];
            
            const langTabs = `
                <div class="ads-lang-tabs">
                    <button class="ads-lang-tab ${currentAdLang === 'en' ? 'active' : ''}" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
                    <button class="ads-lang-tab ${currentAdLang === 'nl' ? 'active' : ''}" data-lang="nl">ðŸ‡³ðŸ‡± NL</button>
                    <button class="ads-lang-tab ${currentAdLang === 'fr' ? 'active' : ''}" data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
                </div>
            `;
            
            const content = `
                ${langTabs}
                
                <div class="form-group">
                    <label>Image</label>
                    <input type="file" id="ad-image-upload-${currentAdTab}" accept="image/*" style="margin-bottom: 0.5rem;">
                    ${ad.imageUrl ? `<img src="${ad.imageUrl}" style="max-width: 300px; display: block; margin-top: 0.5rem; border-radius: 4px;">` : '<p style="color: var(--color-sage);">No image uploaded</p>'}
                </div>
                
                <div class="form-group">
                    <label>Top Text</label>
                    <input type="text" id="ad-top-text" class="form-control" value="${escapeHtml(ad[`topText_${currentAdLang}`] || '')}" placeholder="Enter top text">
                </div>
                
                <div class="form-group">
                    <label>Bottom Text</label>
                    <input type="text" id="ad-bottom-text" class="form-control" value="${escapeHtml(ad[`bottomText_${currentAdLang}`] || '')}" placeholder="Enter bottom text">
                </div>
                
                <div class="form-group">
                    <label>Button Title</label>
                    <input type="text" id="ad-button-title" class="form-control" value="${escapeHtml(ad[`buttonTitle_${currentAdLang}`] || '')}" placeholder="Enter button text">
                </div>
                
                <div class="form-group">
                    <label>Link URL</label>
                    <input type="text" id="ad-link" class="form-control" value="${escapeHtml(ad.link || '')}" placeholder="https://...">
                </div>
                
                <button class="btn" id="save-ad-btn">Save Ad</button>
            `;
            
            container.innerHTML = content;
            
            // Attach handlers (no Quill initialization)
            attachAdSaveHandlers();
        }

        // Attach save handlers for ads
        function attachAdSaveHandlers() {
            const saveBtn = document.getElementById('save-ad-btn');
            const imageInput = document.getElementById(`ad-image-upload-${currentAdTab}`);
            
            if (imageInput) {
                imageInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    if (!file.type.startsWith('image/')) {
                        alert('Please select an image file');
                        return;
                    }
                    
                    try {
                        const timestamp = Date.now();
                        const filename = `index-ads/${currentAdTab}-${timestamp}-${file.name}`;
                        const fileRef = storageRef(storage, filename);
                        
                        await uploadBytes(fileRef, file);
                        const downloadURL = await getDownloadURL(fileRef);
                        
                        adsData[currentAdTab].imageUrl = downloadURL;
                        
                        await set(dbRef(database, 'indexAds'), adsData);
                        
                        renderAdTab();
                        alert('Image uploaded successfully!');
                    } catch (error) {
                        console.error('Error uploading image:', error);
                        alert('Failed to upload image.');
                    }
                });
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', async () => {
                    const topText = document.getElementById('ad-top-text').value;
                    const bottomText = document.getElementById('ad-bottom-text').value;
                    const buttonTitle = document.getElementById('ad-button-title').value;
                    const link = document.getElementById('ad-link').value;
                    
                    adsData[currentAdTab][`topText_${currentAdLang}`] = topText;
                    adsData[currentAdTab][`bottomText_${currentAdLang}`] = bottomText;
                    adsData[currentAdTab][`buttonTitle_${currentAdLang}`] = buttonTitle;
                    adsData[currentAdTab].link = link;
                    
                    try {
                        await set(dbRef(database, 'indexAds'), adsData);
                        alert('Ad saved successfully!');
                    } catch (error) {
                        console.error('Error saving ad:', error);
                        alert('Failed to save ad.');
                    }
                });
            }
        }

        // ============ BACKGROUND PHOTO MANAGEMENT ============
        let currentBackground = null;

        // Load background photo
        async function loadBackgroundPhoto() {
            try {
                const snapshot = await get(dbRef(database, 'indexBackground'));
                
                const backgroundPreview = document.getElementById('background-preview');
                
                if (snapshot.exists() && snapshot.val().url) {
                    currentBackground = snapshot.val();
                    const url = currentBackground.url;
                    backgroundPreview.innerHTML = `
                        <div class="photo-item">
                            <img src="${url}" alt="Background photo">
                            <div class="photo-overlay">
                                <button class="btn-delete" onclick="deleteBackgroundPhoto()">Delete</button>
                            </div>
                        </div>
                    `;
                } else {
                    currentBackground = null;
                    backgroundPreview.innerHTML = '<p style="color: var(--color-sage);">No background photo uploaded</p>';
                }
            } catch (error) {
                console.error('Error loading background photo:', error);
            }
        }

        // Upload background photo
        document.getElementById('add-background-btn').addEventListener('click', () => {
            document.getElementById('background-upload-input').click();
        });

        document.getElementById('background-upload-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            const addBtn = document.getElementById('add-background-btn');
            addBtn.disabled = true;
            addBtn.textContent = 'Uploading...';
            
            try {
                // Delete old background if exists
                if (currentBackground && currentBackground.filename) {
                    try {
                        const oldFileRef = storageRef(storage, currentBackground.filename);
                        await deleteObject(oldFileRef);
                    } catch (deleteError) {
                        // Log specific error but don't fail the upload
                        console.warn('Failed to delete old background file:', deleteError?.message || 'Unknown error');
                    }
                }
                
                // Upload new background
                const timestamp = Date.now();
                const filename = `index-background/${timestamp}-${file.name}`;
                const fileRef = storageRef(storage, filename);
                
                await uploadBytes(fileRef, file);
                const downloadURL = await getDownloadURL(fileRef);
                
                // Save to database
                const backgroundData = {
                    url: downloadURL,
                    filename: filename,
                    timestamp: timestamp
                };
                
                await set(dbRef(database, 'indexBackground'), backgroundData);
                
                // Reload background
                await loadBackgroundPhoto();
                
                // Reset input
                e.target.value = '';
                
                alert('Background photo uploaded successfully!');
            } catch (error) {
                console.error('Error uploading background:', error);
                alert('Failed to upload background photo. Please try again.');
            } finally {
                addBtn.disabled = false;
                addBtn.textContent = 'Upload Background';
            }
        });

        // Add delete background photo function
        async function deleteBackgroundPhoto() {
            if (!confirm('Are you sure you want to delete the background photo?')) {
                return;
            }
            
            try {
                // Delete from storage
                if (currentBackground && currentBackground.filename) {
                    const fileRef = storageRef(storage, currentBackground.filename);
                    await deleteObject(fileRef);
                }
                
                // Delete from database
                await remove(dbRef(database, 'indexBackground'));
                
                // Reload
                await loadBackgroundPhoto();
                
                alert('Background photo deleted successfully!');
            } catch (error) {
                console.error('Error deleting background photo:', error);
                alert('Failed to delete background photo.');
            }
        }
        
        // Make deleteBackgroundPhoto globally accessible
        window.deleteBackgroundPhoto = deleteBackgroundPhoto;

        // ============ ABOUT US MANAGEMENT ============
        let aboutUsData = {
            title: { en: '', nl: '', fr: '' },
            left: {
                subtitle1: { en: '', nl: '', fr: '' },
                subtitle2: { en: '', nl: '', fr: '' },
                textBody: { en: '', nl: '', fr: '' }
            },
            right: {
                subtitle1: { en: '', nl: '', fr: '' },
                subtitle2: { en: '', nl: '', fr: '' },
                textBody: { en: '', nl: '', fr: '' }
            }
        };

        let currentAboutUsTab = 'title';
        let currentAboutUsLang = 'en';

        // Show About Us management card
        document.getElementById('about-us-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            aboutUsCard.style.display = 'block';
            
            aboutUsCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadAboutUsData();
            renderAboutUsTab();
        });

        // Show Ads Bottom management card
        document.getElementById('ads-bottom-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            adsBottomCard.style.display = 'block';
            
            adsBottomCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadAdsBottomData();
            renderAdsBottomTab();
        });

        // Add click handlers for other menu items (Manage Rooms, Manage Packages, View Bookings)
        document.getElementById('manage-rooms-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            // Hide all cards
            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            
            // Show only room card
            roomCard.style.display = 'block';
            roomCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadRoomsData();
            renderRoomsList();
        });

        document.getElementById('manage-packages-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            // Hide all cards
            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            
            // Show only package card
            packageCard.style.display = 'block';
            packageCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Hide menu after selection
            verticalMenu.classList.remove('show');
            
            await loadPackagesData();
            renderPackagesList();
        });

        document.getElementById('view-bookings-btn').addEventListener('click', () => {
            const verticalMenu = document.getElementById('vertical-menu');
            verticalMenu.classList.remove('show');
            // Add your bookings view logic here
            alert('View Bookings functionality - to be implemented');
        });

        // ============ FACILITIES MANAGEMENT ============
        let currentFacilityLang = 'en';
        let facilitiesData = {};
        let facilitiesLibrary = [];
        let facilitiesHeroImage = null;
        let editingFacilityId = null;
        let facilityDraft = null;
        let currentFacilityLibraryId = null;

        // Show facilities management card
        document.getElementById('manage-facilities-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');

            ensureDashboardVisible();

            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            amenitiesCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'block';

            facilitiesCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            verticalMenu.classList.remove('show');

            currentFacilityLang = 'en';
            document.querySelectorAll('.facility-lang-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.lang === 'en');
            });
            updateFacilityLabels();
            initializeFacilityDraft();
            applyFacilityDraft(currentFacilityLang);

            await loadFacilitiesData();
            await loadFacilitiesHero();
            await loadFacilitiesLibrary();
        });

        document.getElementById('facility-library-select').addEventListener('change', async (event) => {
            currentFacilityLibraryId = event.target.value || null;
            await loadFacilitiesLibrary();
        });

        function updateFacilityLabels() {
            const labels = {
                en: {
                    name: 'Facility Name (English)',
                    operation: 'Operation & Description (English)',
                    guidelines: 'Guidelines (English) - one per line'
                },
                nl: {
                    name: 'Facility Name (Nederlands)',
                    operation: 'Operation & Description (Nederlands)',
                    guidelines: 'Guidelines (Nederlands) - one per line'
                },
                fr: {
                    name: 'Facility Name (FranÃ§ais)',
                    operation: 'Operation & Description (FranÃ§ais)',
                    guidelines: 'Guidelines (FranÃ§ais) - one per line'
                }
            };
            document.getElementById('facility-name-label').textContent = labels[currentFacilityLang].name;
            document.getElementById('facility-operation-label').textContent = labels[currentFacilityLang].operation;
            document.getElementById('facility-guidelines-label').textContent = labels[currentFacilityLang].guidelines;
        }

        function initializeFacilityDraft() {
            facilityDraft = {
                en: { name: '', operation: '', guidelines: '' },
                nl: { name: '', operation: '', guidelines: '' },
                fr: { name: '', operation: '', guidelines: '' }
            };
        }

        function syncFacilityDraft() {
            facilityDraft[currentFacilityLang] = {
                name: document.getElementById('facility-name-input').value,
                operation: document.getElementById('facility-operation-input').value,
                guidelines: document.getElementById('facility-guidelines-input').value
            };
        }

        function applyFacilityDraft(lang) {
            const draft = facilityDraft[lang];
            document.getElementById('facility-name-input').value = draft.name || '';
            document.getElementById('facility-operation-input').value = draft.operation || '';
            document.getElementById('facility-guidelines-input').value = draft.guidelines || '';
        }

        function parseGuidelines(value) {
            const trimmed = value.trim();
            if (!trimmed) return [];
            return trimmed.split('\n').map(line => line.trim()).filter(Boolean);
        }

        initializeFacilityDraft();

        document.querySelectorAll('.facility-lang-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                syncFacilityDraft();
                document.querySelectorAll('.facility-lang-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFacilityLang = tab.dataset.lang;
                updateFacilityLabels();
                applyFacilityDraft(currentFacilityLang);
            });
        });

        document.getElementById('add-facility-btn').addEventListener('click', async () => {
            syncFacilityDraft();
            const nameEn = facilityDraft.en.name.trim();
            const nameNl = facilityDraft.nl.name.trim();
            const nameFr = facilityDraft.fr.name.trim();

            if (!nameEn && !nameNl && !nameFr) {
                alert('Please enter a facility name in at least one language');
                return;
            }

            const hasLibrarySelection = !!currentFacilityLibraryId;
            const timestamp = Date.now();
            const facilityId = `facility_${timestamp}`;

            const facilityData = {
                name_en: nameEn,
                name_nl: nameNl,
                name_fr: nameFr,
                operation_en: facilityDraft.en.operation.trim(),
                operation_nl: facilityDraft.nl.operation.trim(),
                operation_fr: facilityDraft.fr.operation.trim(),
                guidelines_en: parseGuidelines(facilityDraft.en.guidelines),
                guidelines_nl: parseGuidelines(facilityDraft.nl.guidelines),
                guidelines_fr: parseGuidelines(facilityDraft.fr.guidelines),
                timestamp
            };

            try {
                await set(dbRef(database, `facilities/${facilityId}`), facilityData);
                initializeFacilityDraft();
                applyFacilityDraft(currentFacilityLang);
                alert('Facility added successfully!');
                await loadFacilitiesData();
                if (!hasLibrarySelection) {
                    currentFacilityLibraryId = facilityId;
                    updateFacilityLibrarySelect();
                    await loadFacilitiesLibrary();
                }
            } catch (error) {
                console.error('Error adding facility:', error);
                alert('Failed to add facility. Please try again.');
            }
        });

        async function loadFacilitiesData() {
            try {
                const snapshot = await get(dbRef(database, 'facilities'));
                facilitiesData = snapshot.exists() ? snapshot.val() : {};
                renderFacilitiesList();
            } catch (error) {
                console.error('Error loading facilities:', error);
            }
        }

        function renderFacilitiesList() {
            const container = document.getElementById('facility-list');
            if (!container) return;

            if (!facilitiesData || Object.keys(facilitiesData).length === 0) {
                container.innerHTML = '<p style="color: var(--color-sage); text-align: center;">No facilities added yet.</p>';
                updateFacilityLibrarySelect();
                return;
            }

            container.innerHTML = Object.keys(facilitiesData).map(id => {
                const facility = facilitiesData[id];
                const nameEn = facility.name_en || 'â€”';
                const nameNl = facility.name_nl || 'â€”';
                const nameFr = facility.name_fr || 'â€”';
                return `
                    <div class="facility-item">
                        <div class="facility-info">
                            <h4>${escapeHtml(nameEn)}</h4>
                            <p>NL: ${escapeHtml(nameNl)} | FR: ${escapeHtml(nameFr)}</p>
                        </div>
                        <div class="facility-actions">
                            <button class="btn-edit-amenity" onclick="editFacility('${id}')">Edit</button>
                            <button class="btn-delete-amenity" onclick="deleteFacility('${id}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
            updateFacilityLibrarySelect();
        }

        function updateFacilityLibrarySelect() {
            const select = document.getElementById('facility-library-select');
            if (!select) return;
            const previousSelection = currentFacilityLibraryId;

            if (!facilitiesData || Object.keys(facilitiesData).length === 0) {
                select.innerHTML = '<option value="">No facilities available</option>';
                select.disabled = true;
                currentFacilityLibraryId = null;
                return;
            }

            select.disabled = false;
            const facilities = Object.keys(facilitiesData).map(id => {
                const facility = facilitiesData[id];
                const name = facility.name_en || facility.name_nl || facility.name_fr || 'Facility';
                return { id, name };
            });

            if (!currentFacilityLibraryId || !facilitiesData[currentFacilityLibraryId]) {
                currentFacilityLibraryId = facilities[0]?.id || null;
            }

            select.innerHTML = facilities.map(({ id, name }) => `
                <option value="${id}" ${id === currentFacilityLibraryId ? 'selected' : ''}>
                    ${escapeHtml(name)}
                </option>
            `).join('');

            if (previousSelection !== currentFacilityLibraryId) {
                loadFacilitiesLibrary();
            }
        }

        window.editFacility = function(facilityId) {
            editingFacilityId = facilityId;
            const facility = facilitiesData[facilityId];

            const modal = document.createElement('div');
            modal.className = 'facility-edit-modal show';
            modal.innerHTML = `
                <div class="facility-edit-content">
                    <h3>Edit Facility</h3>
                    <div class="facility-modal-tabs">
                        <button class="facility-modal-tab active" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
                        <button class="facility-modal-tab" data-lang="nl">ðŸ‡³ðŸ‡± NL</button>
                        <button class="facility-modal-tab" data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
                    </div>
                    <div class="facility-modal-body">
                        <div class="facility-modal-panel" data-lang="en">
                            <div class="form-group">
                                <label>Facility Name (English)</label>
                                <input type="text" id="facility-edit-name-en" class="form-control" value="${escapeHtml(facility.name_en || '')}">
                            </div>
                            <div class="form-group">
                                <label>Operation & Description (English)</label>
                                <textarea id="facility-edit-operation-en" class="admin-textarea">${escapeHtml(facility.operation_en || '')}</textarea>
                            </div>
                            <div class="form-group">
                                <label>Guidelines (English) - one per line</label>
                                <textarea id="facility-edit-guidelines-en" class="admin-textarea">${escapeHtml((facility.guidelines_en || []).join('\n'))}</textarea>
                            </div>
                        </div>
                        <div class="facility-modal-panel" data-lang="nl" style="display: none;">
                            <div class="form-group">
                                <label>Facility Name (Nederlands)</label>
                                <input type="text" id="facility-edit-name-nl" class="form-control" value="${escapeHtml(facility.name_nl || '')}">
                            </div>
                            <div class="form-group">
                                <label>Operation & Description (Nederlands)</label>
                                <textarea id="facility-edit-operation-nl" class="admin-textarea">${escapeHtml(facility.operation_nl || '')}</textarea>
                            </div>
                            <div class="form-group">
                                <label>Guidelines (Nederlands) - one per line</label>
                                <textarea id="facility-edit-guidelines-nl" class="admin-textarea">${escapeHtml((facility.guidelines_nl || []).join('\n'))}</textarea>
                            </div>
                        </div>
                        <div class="facility-modal-panel" data-lang="fr" style="display: none;">
                            <div class="form-group">
                                <label>Facility Name (FranÃ§ais)</label>
                                <input type="text" id="facility-edit-name-fr" class="form-control" value="${escapeHtml(facility.name_fr || '')}">
                            </div>
                            <div class="form-group">
                                <label>Operation & Description (FranÃ§ais)</label>
                                <textarea id="facility-edit-operation-fr" class="admin-textarea">${escapeHtml(facility.operation_fr || '')}</textarea>
                            </div>
                            <div class="form-group">
                                <label>Guidelines (FranÃ§ais) - one per line</label>
                                <textarea id="facility-edit-guidelines-fr" class="admin-textarea">${escapeHtml((facility.guidelines_fr || []).join('\n'))}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="facility-edit-actions">
                        <button class="btn" onclick="saveFacilityEdit()">Save Changes</button>
                        <button class="btn btn-cancel" onclick="closeFacilityEdit()">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelectorAll('.facility-modal-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    modal.querySelectorAll('.facility-modal-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const lang = tab.dataset.lang;
                    modal.querySelectorAll('.facility-modal-panel').forEach(panel => {
                        panel.style.display = panel.dataset.lang === lang ? 'block' : 'none';
                    });
                });
            });
        };

        window.closeFacilityEdit = function() {
            document.querySelector('.facility-edit-modal')?.remove();
            editingFacilityId = null;
        };

        window.saveFacilityEdit = async function() {
            const nameEn = document.getElementById('facility-edit-name-en').value.trim();
            const nameNl = document.getElementById('facility-edit-name-nl').value.trim();
            const nameFr = document.getElementById('facility-edit-name-fr').value.trim();
            const operationEn = document.getElementById('facility-edit-operation-en').value.trim();
            const operationNl = document.getElementById('facility-edit-operation-nl').value.trim();
            const operationFr = document.getElementById('facility-edit-operation-fr').value.trim();
            const guidelinesEn = parseGuidelines(document.getElementById('facility-edit-guidelines-en').value);
            const guidelinesNl = parseGuidelines(document.getElementById('facility-edit-guidelines-nl').value);
            const guidelinesFr = parseGuidelines(document.getElementById('facility-edit-guidelines-fr').value);

            if (!nameEn && !nameNl && !nameFr) {
                alert('Please enter at least one facility name');
                return;
            }

            try {
                await set(dbRef(database, `facilities/${editingFacilityId}`), {
                    name_en: nameEn,
                    name_nl: nameNl,
                    name_fr: nameFr,
                    operation_en: operationEn,
                    operation_nl: operationNl,
                    operation_fr: operationFr,
                    guidelines_en: guidelinesEn,
                    guidelines_nl: guidelinesNl,
                    guidelines_fr: guidelinesFr,
                    timestamp: facilitiesData[editingFacilityId].timestamp
                });
                closeFacilityEdit();
                alert('Facility updated successfully!');
                await loadFacilitiesData();
            } catch (error) {
                console.error('Error updating facility:', error);
                alert('Failed to update facility. Please try again.');
            }
        };

        window.deleteFacility = async function(facilityId) {
            if (!confirm('Are you sure you want to delete this facility?')) {
                return;
            }

            try {
                const librarySnapshot = await get(dbRef(database, `facilitiesLibrary/${facilityId}`));
                if (librarySnapshot.exists()) {
                    await Promise.all(Object.values(librarySnapshot.val()).map(async (photo) => {
                        if (photo?.filename) {
                            try {
                                await deleteObject(storageRef(storage, photo.filename));
                            } catch (deleteError) {
                                console.warn('Failed to delete facility library photo:', deleteError?.message || 'Unknown error');
                            }
                        }
                    }));
                }
                await set(dbRef(database, `facilities/${facilityId}`), null);
                await set(dbRef(database, `facilitiesLibrary/${facilityId}`), null);
                if (currentFacilityLibraryId === facilityId) {
                    currentFacilityLibraryId = null;
                }
                alert('Facility deleted successfully!');
                await loadFacilitiesData();
            } catch (error) {
                console.error('Error deleting facility:', error);
                alert('Failed to delete facility.');
            }
        };

        document.getElementById('upload-facility-hero-btn').addEventListener('click', () => {
            document.getElementById('facility-hero-upload-input').click();
        });

        document.getElementById('facility-hero-upload-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            const uploadBtn = document.getElementById('upload-facility-hero-btn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';

            try {
                if (facilitiesHeroImage && facilitiesHeroImage.filename) {
                    try {
                        await deleteObject(storageRef(storage, facilitiesHeroImage.filename));
                    } catch (deleteError) {
                        console.warn('Failed to delete old facilities hero image:', deleteError?.message || 'Unknown error');
                    }
                }

                const timestamp = Date.now();
                const sanitizedName = sanitizeFilename(file.name);
                const filename = `facilities-hero/${timestamp}-${sanitizedName}`;
                const fileRef = storageRef(storage, filename);

                await uploadBytes(fileRef, file);
                const downloadURL = await getDownloadURL(fileRef);

                facilitiesHeroImage = {
                    url: downloadURL,
                    filename,
                    timestamp
                };

                await set(dbRef(database, 'facilitiesHero'), facilitiesHeroImage);
                await loadFacilitiesHero();

                e.target.value = '';
                alert('Facilities main image uploaded successfully!');
            } catch (error) {
                console.error('Error uploading facilities hero image:', error);
                const message = error?.message ? `: ${error.message}` : '';
                alert(`Failed to upload main image${message}`);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Upload Main Image';
            }
        });

        async function loadFacilitiesHero() {
            try {
                const snapshot = await get(dbRef(database, 'facilitiesHero'));
                facilitiesHeroImage = snapshot.exists() ? snapshot.val() : null;
                const preview = document.getElementById('facility-hero-preview');
                if (!preview) return;

                if (facilitiesHeroImage && facilitiesHeroImage.url) {
                    preview.innerHTML = `
                        <div class="photo-item">
                            <img src="${facilitiesHeroImage.url}" alt="Facilities main image">
                            <div class="photo-overlay">
                                <button class="btn-delete" onclick="deleteFacilitiesHero()">Delete</button>
                            </div>
                        </div>
                    `;
                } else {
                    preview.innerHTML = '<p style="color: var(--color-sage);">No main image uploaded.</p>';
                }
            } catch (error) {
                console.error('Error loading facilities hero image:', error);
            }
        }

        window.deleteFacilitiesHero = async function() {
            if (!confirm('Are you sure you want to delete the main image?')) {
                return;
            }

            try {
                if (facilitiesHeroImage && facilitiesHeroImage.filename) {
                    await deleteObject(storageRef(storage, facilitiesHeroImage.filename));
                }
                await remove(dbRef(database, 'facilitiesHero'));
                facilitiesHeroImage = null;
                await loadFacilitiesHero();
                alert('Main image deleted successfully!');
            } catch (error) {
                console.error('Error deleting facilities hero image:', error);
                alert('Failed to delete main image.');
            }
        };

        document.getElementById('upload-facility-library-btn').addEventListener('click', () => {
            document.getElementById('facility-library-input').click();
        });

        document.getElementById('facility-library-input').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files || []);
            if (!files.length) return;

            if (!currentFacilityLibraryId) {
                alert('Please select a facility before uploading photos.');
                e.target.value = '';
                return;
            }

            const uploadBtn = document.getElementById('upload-facility-library-btn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';

            try {
                let uploadCounter = 0;
                for (const file of files) {
                    if (!file.type.startsWith('image/')) {
                        continue;
                    }
                    const timestamp = Date.now() + uploadCounter;
                    uploadCounter += 1;
                    const sanitizedName = sanitizeFilename(file.name);
                    const filename = `facilities-library/${timestamp}-${sanitizedName}`;
                    const fileRef = storageRef(storage, filename);
                    await uploadBytes(fileRef, file);
                    const downloadURL = await getDownloadURL(fileRef);
                    facilitiesLibrary.push({
                        url: downloadURL,
                        filename,
                        timestamp,
                        order: facilitiesLibrary.length
                    });
                }

                await saveFacilitiesLibrary();
                await loadFacilitiesLibrary();
                e.target.value = '';
                alert('Facilities library updated!');
            } catch (error) {
                console.error('Error uploading facilities library images:', error);
                const message = error?.message ? `: ${error.message}` : '';
                alert(`Failed to upload facility images${message}`);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Add Library Photos';
            }
        });

        async function loadFacilitiesLibrary() {
            try {
                if (!currentFacilityLibraryId) {
                    facilitiesLibrary = [];
                    renderFacilitiesLibrary();
                    return;
                }
                const snapshot = await get(dbRef(database, `facilitiesLibrary/${currentFacilityLibraryId}`));
                facilitiesLibrary = [];
                if (snapshot.exists()) {
                    facilitiesLibrary = Object.values(snapshot.val()).sort((a, b) => (a.order ?? 0) - (b.order ?? 0));
                }
                renderFacilitiesLibrary();
            } catch (error) {
                console.error('Error loading facilities library:', error);
            }
        }

        function renderFacilitiesLibrary() {
            const grid = document.getElementById('facility-library-grid');
            if (!grid) return;

            if (!currentFacilityLibraryId) {
                grid.innerHTML = '<p style="color: var(--color-sage);">Select a facility to manage its photo album.</p>';
                return;
            }

            if (facilitiesLibrary.length === 0) {
                grid.innerHTML = '<p style="color: var(--color-sage);">No library photos uploaded yet.</p>';
                return;
            }

            grid.innerHTML = '';
            facilitiesLibrary.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.draggable = true;
                item.dataset.index = index;
                item.innerHTML = `
                    <img src="${photo.url}" alt="Facility library photo ${index + 1}">
                    <div class="photo-overlay">
                        <button class="btn-delete" onclick="deleteFacilityLibraryPhoto(${index})">Delete</button>
                    </div>
                `;
                item.addEventListener('dragstart', handleFacilityLibraryDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleFacilityLibraryDrop);
                item.addEventListener('dragend', handleFacilityLibraryDragEnd);
                grid.appendChild(item);
            });
        }

        let facilityLibraryDraggedIndex = null;

        function handleFacilityLibraryDragStart(e) {
            facilityLibraryDraggedIndex = parseInt(e.currentTarget.dataset.index);
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        async function handleFacilityLibraryDrop(e) {
            e.stopPropagation();
            e.preventDefault();

            const dropIndex = parseInt(e.currentTarget.dataset.index);
            if (facilityLibraryDraggedIndex !== null && facilityLibraryDraggedIndex !== dropIndex) {
                await reorderFacilitiesLibrary(facilityLibraryDraggedIndex, dropIndex);
            }
        }

        function handleFacilityLibraryDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            facilityLibraryDraggedIndex = null;
            document.querySelectorAll('#facility-library-grid .photo-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        async function reorderFacilitiesLibrary(fromIndex, toIndex) {
            try {
                const reordered = [...facilitiesLibrary];
                const [moved] = reordered.splice(fromIndex, 1);
                reordered.splice(toIndex, 0, moved);
                reordered.forEach((photo, index) => {
                    photo.order = index;
                });
                facilitiesLibrary = reordered;
                await saveFacilitiesLibrary();
                renderFacilitiesLibrary();
            } catch (error) {
                console.error('Error reordering facilities library:', error);
                alert('Failed to reorder photos.');
            }
        }

        async function saveFacilitiesLibrary() {
            if (!currentFacilityLibraryId) {
                return;
            }
            const updates = {};
            facilitiesLibrary.forEach(photo => {
                updates[photo.timestamp] = photo;
            });
            await set(dbRef(database, `facilitiesLibrary/${currentFacilityLibraryId}`), updates);
        }

        window.deleteFacilityLibraryPhoto = async function(index) {
            if (!confirm('Are you sure you want to delete this photo?')) {
                return;
            }

            try {
                if (!currentFacilityLibraryId) {
                    alert('Please select a facility album.');
                    return;
                }
                if (index < 0 || index >= facilitiesLibrary.length) {
                    alert('Invalid photo index.');
                    return;
                }
                const photo = facilitiesLibrary[index];
                if (photo.filename) {
                    await deleteObject(storageRef(storage, photo.filename));
                }
                facilitiesLibrary.splice(index, 1);
                facilitiesLibrary.forEach((item, idx) => {
                    item.order = idx;
                });
                await saveFacilitiesLibrary();
                renderFacilitiesLibrary();
                alert('Photo deleted successfully!');
            } catch (error) {
                console.error('Error deleting facilities photo:', error);
                alert('Failed to delete photo.');
            }
        };

        // ============ AMENITIES MANAGEMENT ============
        let currentAmenityLang = 'en';
        let amenitiesData = {};
        let editingAmenityId = null;

        // Show amenities management card
        document.getElementById('set-amenities-btn').addEventListener('click', async () => {
            const photoCard = document.getElementById('photo-management-card');
            const adsCard = document.getElementById('ads-management-card');
            const aboutUsCard = document.getElementById('about-us-management-card');
            const adsBottomCard = document.getElementById('ads-bottom-management-card');
            const amenitiesCard = document.getElementById('amenities-management-card');
            const roomCard = document.getElementById('room-management-card');
            const packageCard = document.getElementById('package-management-card');
            const facilitiesCard = document.getElementById('facilities-management-card');
            const verticalMenu = document.getElementById('vertical-menu');
            
            ensureDashboardVisible();
            
            photoCard.style.display = 'none';
            adsCard.style.display = 'none';
            aboutUsCard.style.display = 'none';
            adsBottomCard.style.display = 'none';
            roomCard.style.display = 'none';
            packageCard.style.display = 'none';
            facilitiesCard.style.display = 'none';
            amenitiesCard.style.display = 'block';
            
            amenitiesCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            verticalMenu.classList.remove('show');
            
            await loadAmenities();
        });

        // Language tab switching
        document.querySelectorAll('.lang-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentAmenityLang = tab.dataset.lang;
                updateAmenityLabel();
            });
        });

        function updateAmenityLabel() {
            const labels = {
                en: 'Amenity Name (English)',
                nl: 'Amenity Name (Nederlands)',
                fr: 'Amenity Name (FranÃ§ais)'
            };
            document.getElementById('amenity-name-label').textContent = labels[currentAmenityLang];
        }

        // Add new amenity
        document.getElementById('add-amenity-btn').addEventListener('click', async () => {
            const input = document.getElementById('amenity-name-input');
            const name = input.value.trim();
            
            if (!name) {
                alert('Please enter an amenity name');
                return;
            }
            
            // Create temporary amenity object with all languages
            const timestamp = Date.now();
            const amenityId = `amenity_${timestamp}`;
            
            // Initialize with current language, others can be edited later
            const amenityData = {
                name_en: currentAmenityLang === 'en' ? name : '',
                name_nl: currentAmenityLang === 'nl' ? name : '',
                name_fr: currentAmenityLang === 'fr' ? name : '',
                timestamp: timestamp
            };
            
            try {
                await set(dbRef(database, `amenitiesMaster/${amenityId}`), amenityData);
                input.value = '';
                alert('Amenity added successfully!');
                await loadAmenities();
            } catch (error) {
                console.error('Error adding amenity:', error);
                alert('Failed to add amenity. Please try again.');
            }
        });

        // Load all amenities
        async function loadAmenities() {
            try {
                const snapshot = await get(dbRef(database, 'amenitiesMaster'));
                
                if (!snapshot.exists()) {
                    amenitiesData = {};
                    renderAmenitiesList();
                    return;
                }
                
                amenitiesData = snapshot.val();
                renderAmenitiesList();
            } catch (error) {
                console.error('Error loading amenities:', error);
            }
        }

        // Render amenities list
        function renderAmenitiesList() {
            const container = document.getElementById('amenities-list');
            
            if (Object.keys(amenitiesData).length === 0) {
                container.innerHTML = '<p style="color: var(--color-sage); text-align: center;">No amenities added yet. Add your first amenity above.</p>';
                return;
            }
            
            let html = '';
            
            Object.keys(amenitiesData).forEach(id => {
                const amenity = amenitiesData[id];
                const nameEn = amenity.name_en || 'â€”';
                const nameNl = amenity.name_nl || 'â€”';
                const nameFr = amenity.name_fr || 'â€”';
                
                html += `
                    <div class="amenity-item">
                        <div class="amenity-info">
                            <div class="amenity-name">${escapeHtml(nameEn)}</div>
                            <div class="amenity-translations">
                                NL: ${escapeHtml(nameNl)} | FR: ${escapeHtml(nameFr)}
                            </div>
                        </div>
                        <div class="amenity-actions">
                            <button class="btn-edit-amenity" onclick="editAmenity('${id}')">Edit</button>
                            <button class="btn-delete-amenity" onclick="deleteAmenity('${id}')">Delete</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Edit amenity
        window.editAmenity = function(amenityId) {
            editingAmenityId = amenityId;
            const amenity = amenitiesData[amenityId];
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'amenity-edit-modal show';
            modal.innerHTML = `
                <div class="amenity-edit-content">
                    <h3>Edit Amenity</h3>
                    <div class="form-group">
                        <label>English Name</label>
                        <input type="text" id="edit-name-en" class="form-control" value="${escapeHtml(amenity.name_en || '')}">
                    </div>
                    <div class="form-group">
                        <label>Nederlands Name</label>
                        <input type="text" id="edit-name-nl" class="form-control" value="${escapeHtml(amenity.name_nl || '')}">
                    </div>
                    <div class="form-group">
                        <label>FranÃ§ais Name</label>
                        <input type="text" id="edit-name-fr" class="form-control" value="${escapeHtml(amenity.name_fr || '')}">
                    </div>
                    <div class="amenity-edit-actions">
                        <button class="btn" onclick="saveAmenityEdit()">Save Changes</button>
                        <button class="btn btn-cancel" onclick="closeEditModal()">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        // Save amenity edit
        window.saveAmenityEdit = async function() {
            const nameEn = document.getElementById('edit-name-en').value.trim();
            const nameNl = document.getElementById('edit-name-nl').value.trim();
            const nameFr = document.getElementById('edit-name-fr').value.trim();
            
            if (!nameEn && !nameNl && !nameFr) {
                alert('Please enter at least one name');
                return;
            }
            
            try {
                await set(dbRef(database, `amenitiesMaster/${editingAmenityId}`), {
                    name_en: nameEn,
                    name_nl: nameNl,
                    name_fr: nameFr,
                    timestamp: amenitiesData[editingAmenityId].timestamp
                });
                
                closeEditModal();
                alert('Amenity updated successfully!');
                await loadAmenities();
            } catch (error) {
                console.error('Error updating amenity:', error);
                alert('Failed to update amenity. Please try again.');
            }
        };

        // Close edit modal
        window.closeEditModal = function() {
            const modal = document.querySelector('.amenity-edit-modal');
            if (modal) {
                modal.remove();
            }
            editingAmenityId = null;
        };

        // Delete amenity
        window.deleteAmenity = async function(amenityId) {
            if (!confirm('Are you sure you want to delete this amenity? It will be removed from all rooms that use it.')) {
                return;
            }
            
            try {
                await set(dbRef(database, `amenitiesMaster/${amenityId}`), null);
                alert('Amenity deleted successfully!');
                await loadAmenities();
            } catch (error) {
                console.error('Error deleting amenity:', error);
                alert('Failed to delete amenity. Please try again.');
            }
        };

        // Tab switching
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('about-us-tab')) {
                document.querySelectorAll('.about-us-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAboutUsTab = e.target.dataset.tab;
                renderAboutUsTab();
            }
            
            if (e.target.classList.contains('about-us-lang-tab')) {
                document.querySelectorAll('.about-us-lang-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAboutUsLang = e.target.dataset.lang;
                renderAboutUsTab();
            }
        });

        // Load About Us data from Firebase
        async function loadAboutUsData() {
            try {
                const snapshot = await get(dbRef(database, 'aboutUs'));
                
                if (snapshot.exists()) {
                    aboutUsData = snapshot.val();
                }
            } catch (error) {
                console.error('Error loading About Us data:', error);
            }
        }

        // Render tab content
        function renderAboutUsTab() {
            const container = document.getElementById('about-us-tab-content');
            
            // Language tabs
            const langTabs = `
                <div class="about-us-lang-tabs">
                    <button class="about-us-lang-tab ${currentAboutUsLang === 'en' ? 'active' : ''}" data-lang="en" aria-label="English">ðŸ‡¬ðŸ‡§ EN</button>
                    <button class="about-us-lang-tab ${currentAboutUsLang === 'nl' ? 'active' : ''}" data-lang="nl" aria-label="Nederlands">ðŸ‡³ðŸ‡± NL</button>
                    <button class="about-us-lang-tab ${currentAboutUsLang === 'fr' ? 'active' : ''}" data-lang="fr" aria-label="FranÃ§ais">ðŸ‡«ðŸ‡· FR</button>
                </div>
            `;
            
            let content = '';
            
            if (currentAboutUsTab === 'title') {
                const titleValue = aboutUsData.title[currentAboutUsLang] || '';
                content = `
                    ${langTabs}
                    <div class="about-us-section">
                        <h4>About Us Title</h4>
                        <div class="form-group">
                            <input type="text" id="about-us-title-input" class="form-control" value="${escapeHtml(titleValue)}" placeholder="Enter title">
                        </div>
                    </div>
                    <button class="btn" id="save-about-us-title-btn">Save Title</button>
                `;
            } else if (currentAboutUsTab === 'left') {
                const sub1 = aboutUsData.left.subtitle1[currentAboutUsLang] || '';
                const sub2 = aboutUsData.left.subtitle2[currentAboutUsLang] || '';
                const body = aboutUsData.left.textBody[currentAboutUsLang] || '';
                
                content = `
                    ${langTabs}
                    <div class="about-us-section">
                        <h4>Subtitle 1</h4>
                        <div class="form-group">
                            <input type="text" id="about-us-left-sub1" class="form-control" value="${escapeHtml(sub1)}" placeholder="Enter subtitle 1">
                        </div>
                    </div>
                    <div class="about-us-section">
                        <h4>Subtitle 2</h4>
                        <div class="form-group">
                            <input type="text" id="about-us-left-sub2" class="form-control" value="${escapeHtml(sub2)}" placeholder="Enter subtitle 2">
                        </div>
                    </div>
                    <div class="about-us-section">
                        <h4>Text Body</h4>
                        <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                        <textarea id="about-us-left-body" class="admin-textarea" placeholder="Enter text body">${escapeHtml(body)}</textarea>
                    </div>
                    <button class="btn" id="save-about-us-left-btn">Save Left Content</button>
                `;
            } else if (currentAboutUsTab === 'right') {
                const sub1 = aboutUsData.right.subtitle1[currentAboutUsLang] || '';
                const sub2 = aboutUsData.right.subtitle2[currentAboutUsLang] || '';
                const body = aboutUsData.right.textBody[currentAboutUsLang] || '';
                
                content = `
                    ${langTabs}
                    <div class="about-us-section">
                        <h4>Subtitle 1</h4>
                        <div class="form-group">
                            <input type="text" id="about-us-right-sub1" class="form-control" value="${escapeHtml(sub1)}" placeholder="Enter subtitle 1">
                        </div>
                    </div>
                    <div class="about-us-section">
                        <h4>Subtitle 2</h4>
                        <div class="form-group">
                            <input type="text" id="about-us-right-sub2" class="form-control" value="${escapeHtml(sub2)}" placeholder="Enter subtitle 2">
                        </div>
                    </div>
                    <div class="about-us-section">
                        <h4>Text Body</h4>
                        <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                        <textarea id="about-us-right-body" class="admin-textarea" placeholder="Enter text body">${escapeHtml(body)}</textarea>
                    </div>
                    <button class="btn" id="save-about-us-right-btn">Save Right Content</button>
                `;
            }
            
            container.innerHTML = content;
            
            // Attach save handlers (no Quill initialization needed)
            attachAboutUsSaveHandlers();
        }

        // Attach save button handlers
        function attachAboutUsSaveHandlers() {
            const saveTitleBtn = document.getElementById('save-about-us-title-btn');
            const saveLeftBtn = document.getElementById('save-about-us-left-btn');
            const saveRightBtn = document.getElementById('save-about-us-right-btn');
            
            if (saveTitleBtn) {
                saveTitleBtn.addEventListener('click', async () => {
                    const value = document.getElementById('about-us-title-input').value;
                    aboutUsData.title[currentAboutUsLang] = value;
                    await saveAboutUsData();
                });
            }
            
            if (saveLeftBtn) {
                saveLeftBtn.addEventListener('click', async () => {
                    aboutUsData.left.subtitle1[currentAboutUsLang] = document.getElementById('about-us-left-sub1').value;
                    aboutUsData.left.subtitle2[currentAboutUsLang] = document.getElementById('about-us-left-sub2').value;
                    aboutUsData.left.textBody[currentAboutUsLang] = document.getElementById('about-us-left-body').value;
                    await saveAboutUsData();
                });
            }
            
            if (saveRightBtn) {
                saveRightBtn.addEventListener('click', async () => {
                    aboutUsData.right.subtitle1[currentAboutUsLang] = document.getElementById('about-us-right-sub1').value;
                    aboutUsData.right.subtitle2[currentAboutUsLang] = document.getElementById('about-us-right-sub2').value;
                    aboutUsData.right.textBody[currentAboutUsLang] = document.getElementById('about-us-right-body').value;
                    await saveAboutUsData();
                });
            }
        }

        // Save to Firebase
        async function saveAboutUsData() {
            try {
                await set(dbRef(database, 'aboutUs'), aboutUsData);
                alert('About Us content saved successfully!');
            } catch (error) {
                console.error('Error saving About Us data:', error);
                alert('Failed to save. Please try again.');
            }
        }

        // ============ ADS BOTTOM MANAGEMENT ============
        let adsBottomData = {
            titles: {
                title1_en: '', title1_nl: '', title1_fr: '',
                title2_en: '', title2_nl: '', title2_fr: '',
                title3_en: '', title3_nl: '', title3_fr: ''
            },
            ad1: {
                imageUrl: '',
                title_en: '', title_nl: '', title_fr: '',
                body_en: '', body_nl: '', body_fr: ''
            },
            ad2: {
                imageUrl: '',
                title_en: '', title_nl: '', title_fr: '',
                body_en: '', body_nl: '', body_fr: ''
            },
            ad3: {
                imageUrl: '',
                title_en: '', title_nl: '', title_fr: '',
                body_en: '', body_nl: '', body_fr: ''
            }
        };

        let currentAdsBottomTab = 'titles';
        let currentAdsBottomLang = 'en';

        // Tab switching for Ads Bottom
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('ads-bottom-tab')) {
                document.querySelectorAll('.ads-bottom-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAdsBottomTab = e.target.dataset.tab;
                renderAdsBottomTab();
            }
            
            if (e.target.classList.contains('ads-bottom-lang-tab')) {
                document.querySelectorAll('.ads-bottom-lang-tab').forEach(tab => tab.classList.remove('active'));
                e.target.classList.add('active');
                currentAdsBottomLang = e.target.dataset.lang;
                renderAdsBottomTab();
            }
        });

        // Load Ads Bottom data from Firebase
        async function loadAdsBottomData() {
            try {
                const snapshot = await get(dbRef(database, 'adsBottom'));
                
                if (snapshot.exists()) {
                    adsBottomData = snapshot.val();
                }
            } catch (error) {
                console.error('Error loading Ads Bottom data:', error);
            }
        }

        // Render Ads Bottom tab content
        function renderAdsBottomTab() {
            const container = document.getElementById('ads-bottom-tab-content');
            
            // Language tabs
            const langTabs = `
                <div class="ads-bottom-lang-tabs">
                    <button class="ads-bottom-lang-tab ${currentAdsBottomLang === 'en' ? 'active' : ''}" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
                    <button class="ads-bottom-lang-tab ${currentAdsBottomLang === 'nl' ? 'active' : ''}" data-lang="nl">ðŸ‡³ðŸ‡± NL</button>
                    <button class="ads-bottom-lang-tab ${currentAdsBottomLang === 'fr' ? 'active' : ''}" data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
                </div>
            `;
            
            let content = '';
            
            if (currentAdsBottomTab === 'titles') {
                const title1 = adsBottomData.titles[`title1_${currentAdsBottomLang}`] || '';
                const title2 = adsBottomData.titles[`title2_${currentAdsBottomLang}`] || '';
                const title3 = adsBottomData.titles[`title3_${currentAdsBottomLang}`] || '';
                
                content = `
                    ${langTabs}
                    <div class="form-group">
                        <label>Title 1</label>
                        <input type="text" id="ads-bottom-title1" class="form-control" value="${escapeHtml(title1)}" placeholder="Enter title 1">
                    </div>
                    <div class="form-group">
                        <label>Title 2</label>
                        <input type="text" id="ads-bottom-title2" class="form-control" value="${escapeHtml(title2)}" placeholder="Enter title 2">
                    </div>
                    <div class="form-group">
                        <label>Title 3</label>
                        <input type="text" id="ads-bottom-title3" class="form-control" value="${escapeHtml(title3)}" placeholder="Enter title 3">
                    </div>
                    <button class="btn" id="save-ads-bottom-titles-btn">Save Titles</button>
                `;
            } else {
                // Ad tab (ad1, ad2, or ad3)
                const ad = adsBottomData[currentAdsBottomTab];
                const title = ad[`title_${currentAdsBottomLang}`] || '';
                const body = ad[`body_${currentAdsBottomLang}`] || '';
                
                content = `
                    ${langTabs}
                    <div class="form-group">
                        <label>Image</label>
                        <input type="file" id="ads-bottom-image-upload-${currentAdsBottomTab}" accept="image/*" style="margin-bottom: 0.5rem;">
                        ${ad.imageUrl ? `<img src="${ad.imageUrl}" style="max-width: 300px; display: block; margin-top: 0.5rem; border-radius: 4px;">` : '<p style="color: var(--color-sage);">No image uploaded</p>'}
                    </div>
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="ads-bottom-ad-title" class="form-control" value="${escapeHtml(title)}" placeholder="Enter title">
                    </div>
                    <div class="form-group">
                        <label>Body Text</label>
                        <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                        <textarea id="ads-bottom-ad-body" class="admin-textarea" placeholder="Enter body text">${escapeHtml(body)}</textarea>
                    </div>
                    <button class="btn" id="save-ads-bottom-ad-btn">Save Ad</button>
                `;
            }
            
            container.innerHTML = content;
            
            // Attach save handlers
            attachAdsBottomSaveHandlers();
        }

        // Attach save button handlers for Ads Bottom
        function attachAdsBottomSaveHandlers() {
            const saveTitlesBtn = document.getElementById('save-ads-bottom-titles-btn');
            const saveAdBtn = document.getElementById('save-ads-bottom-ad-btn');
            
            if (saveTitlesBtn) {
                saveTitlesBtn.addEventListener('click', async () => {
                    adsBottomData.titles[`title1_${currentAdsBottomLang}`] = document.getElementById('ads-bottom-title1').value;
                    adsBottomData.titles[`title2_${currentAdsBottomLang}`] = document.getElementById('ads-bottom-title2').value;
                    adsBottomData.titles[`title3_${currentAdsBottomLang}`] = document.getElementById('ads-bottom-title3').value;
                    await saveAdsBottomData();
                });
            }
            
            if (saveAdBtn) {
                const imageInput = document.getElementById(`ads-bottom-image-upload-${currentAdsBottomTab}`);
                
                if (imageInput) {
                    imageInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        if (!file.type.startsWith('image/')) {
                            alert('Please select an image file');
                            return;
                        }
                        
                        try {
                            const timestamp = Date.now();
                            const filename = `ads-bottom/${currentAdsBottomTab}-${timestamp}-${file.name}`;
                            const fileRef = storageRef(storage, filename);
                            
                            await uploadBytes(fileRef, file);
                            const downloadURL = await getDownloadURL(fileRef);
                            
                            adsBottomData[currentAdsBottomTab].imageUrl = downloadURL;
                            
                            await set(dbRef(database, 'adsBottom'), adsBottomData);
                            
                            renderAdsBottomTab();
                            alert('Image uploaded successfully!');
                        } catch (error) {
                            console.error('Error uploading image:', error);
                            alert('Failed to upload image.');
                        }
                    });
                }
                
                saveAdBtn.addEventListener('click', async () => {
                    const title = document.getElementById('ads-bottom-ad-title').value;
                    const body = document.getElementById('ads-bottom-ad-body').value;
                    
                    adsBottomData[currentAdsBottomTab][`title_${currentAdsBottomLang}`] = title;
                    adsBottomData[currentAdsBottomTab][`body_${currentAdsBottomLang}`] = body;
                    
                    await saveAdsBottomData();
                });
            }
        }

        // Save Ads Bottom data to Firebase
        async function saveAdsBottomData() {
            try {
                await set(dbRef(database, 'adsBottom'), adsBottomData);
                alert('Ads Bottom content saved successfully!');
            } catch (error) {
                console.error('Error saving Ads Bottom data:', error);
                alert('Failed to save. Please try again.');
            }
        }

        // ============ PACKAGE MANAGEMENT ============
        let packagesData = [];
        let currentPackageStatus = 'active';
        let packageModalOpen = false;
        let editingPackageId = null;

        // Load packages data from Firebase
        async function loadPackagesData() {
            try {
                const snapshot = await get(dbRef(database, 'packages'));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    packagesData = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                } else {
                    packagesData = [];
                }
            } catch (error) {
                console.error('Error loading packages:', error);
                packagesData = [];
            }
        }

        // Save packages data to Firebase
        async function savePackagesData() {
            try {
                const dataToSave = {};
                packagesData.forEach(pkg => {
                    const { id, ...packageData } = pkg;
                    dataToSave[id] = packageData;
                });
                await set(dbRef(database, 'packages'), dataToSave);
            } catch (error) {
                console.error('Error saving packages:', error);
                throw error;
            }
        }

        // Render packages list
        function renderPackagesList() {
            const container = document.getElementById('package-list-container');
            const filteredPackages = packagesData.filter(pkg => 
                pkg.status === currentPackageStatus
            );

            if (filteredPackages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--color-sage);">
                        <p>No ${currentPackageStatus} packages found.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPackages.map(pkg => `
                <div class="package-item" data-package-id="${pkg.id}" draggable="true">
                    <div class="package-item-content">
                        <div class="package-item-image">
                            ${pkg.imageUrl ? `<img src="${pkg.imageUrl}" alt="${pkg.title_en || 'Package'}">` : '<div class="no-image">No Image</div>'}
                        </div>
                        <div class="package-item-details">
                            <h3>${pkg.title_en || 'Untitled Package'}</h3>
                            <p>${pkg.description_en ? pkg.description_en.substring(0, 100) + '...' : 'No description'}</p>
                            <div class="package-item-actions">
                                <button class="btn btn-small edit-package-btn" data-package-id="${pkg.id}">Edit</button>
                                <button class="btn btn-small btn-danger delete-package-btn" data-package-id="${pkg.id}">Delete</button>
                                <button class="btn btn-small toggle-status-btn" data-package-id="${pkg.id}">
                                    ${pkg.status === 'active' ? 'Deactivate' : 'Activate'}
                                </button>
                            </div>
                        </div>
                        <div class="package-drag-handle">â‹®â‹®</div>
                    </div>
                </div>
            `).join('');

            // Add drag and drop functionality
            setupDragAndDrop();
            
            // Add event listeners
            document.querySelectorAll('.edit-package-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const packageId = e.target.dataset.packageId;
                    openPackageModal(packageId);
                });
            });

            document.querySelectorAll('.delete-package-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const packageId = e.target.dataset.packageId;
                    await deletePackage(packageId);
                });
            });

            document.querySelectorAll('.toggle-status-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const packageId = e.target.dataset.packageId;
                    await togglePackageStatus(packageId);
                });
            });
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            const packageItems = document.querySelectorAll('.package-item');
            let draggedElement = null;

            packageItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedElement = item;
                    item.style.opacity = '0.5';
                });

                item.addEventListener('dragend', (e) => {
                    item.style.opacity = '1';
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    if (draggedElement !== item) {
                        const allItems = Array.from(packageItems);
                        const draggedIndex = allItems.indexOf(draggedElement);
                        const targetIndex = allItems.indexOf(item);

                        const draggedId = draggedElement.dataset.packageId;
                        const targetId = item.dataset.packageId;

                        // Reorder in data
                        const draggedPkg = packagesData.find(p => p.id === draggedId);
                        const draggedDataIndex = packagesData.indexOf(draggedPkg);
                        const targetPkg = packagesData.find(p => p.id === targetId);
                        const targetDataIndex = packagesData.indexOf(targetPkg);

                        packagesData.splice(draggedDataIndex, 1);
                        packagesData.splice(targetDataIndex, 0, draggedPkg);

                        await savePackagesData();
                        renderPackagesList();
                    }
                });
            });
        }

        // Open package modal
        function openPackageModal(packageId = null) {
            editingPackageId = packageId;
            const pkg = packageId ? packagesData.find(p => p.id === packageId) : null;

            const modalHTML = `
                <div id="package-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center; overflow-y: auto;">
                    <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 2rem;">
                        <h2>${packageId ? 'Edit Package' : 'Add New Package'}</h2>
                        
                        <!-- Language Tabs -->
                        <div class="package-lang-tabs" style="margin: 1rem 0; display: flex; gap: 0.5rem;">
                            <button class="package-lang-tab active" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
                            <button class="package-lang-tab" data-lang="nl">ðŸ‡³ðŸ‡± NL</button>
                            <button class="package-lang-tab" data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
                        </div>

                        <!-- Package Image -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Package Image</label>
                            <input type="file" id="package-image-input" accept="image/*" style="display: none;">
                            <button class="btn" id="package-upload-image-btn">Upload Image</button>
                            <div id="package-image-preview" style="margin-top: 1rem;">
                                ${pkg && pkg.imageUrl ? `<img src="${pkg.imageUrl}" style="max-width: 300px; border-radius: 8px;">` : ''}
                            </div>
                        </div>

                        <!-- Multi-language fields -->
                        <div id="package-lang-en" class="package-lang-content">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Title (English)</label>
                                <input type="text" id="package-title-en" class="form-input" value="${pkg ? (pkg.title_en || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (English)</label>
                                <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                                <textarea id="package-description-en" class="admin-textarea">${pkg ? (pkg.description_en || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Inclusions (English) - One per line</label>
                                <textarea id="package-inclusions-en" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.inclusions_en || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Good to Know (English) - One per line</label>
                                <textarea id="package-goodtoknow-en" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.goodToKnow_en || '') : ''}</textarea>
                            </div>
                        </div>

                        <div id="package-lang-nl" class="package-lang-content" style="display: none;">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Title (Dutch)</label>
                                <input type="text" id="package-title-nl" class="form-input" value="${pkg ? (pkg.title_nl || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (Dutch)</label>
                                <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                                <textarea id="package-description-nl" class="admin-textarea">${pkg ? (pkg.description_nl || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Inclusions (Dutch) - One per line</label>
                                <textarea id="package-inclusions-nl" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.inclusions_nl || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Good to Know (Dutch) - One per line</label>
                                <textarea id="package-goodtoknow-nl" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.goodToKnow_nl || '') : ''}</textarea>
                            </div>
                        </div>

                        <div id="package-lang-fr" class="package-lang-content" style="display: none;">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Title (French)</label>
                                <input type="text" id="package-title-fr" class="form-input" value="${pkg ? (pkg.title_fr || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (French)</label>
                                <p style="color: var(--color-sage); font-size: 0.9rem; margin-bottom: 0.5rem;">Tip: Press Enter to add line spacing between paragraphs</p>
                                <textarea id="package-description-fr" class="admin-textarea">${pkg ? (pkg.description_fr || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Inclusions (French) - One per line</label>
                                <textarea id="package-inclusions-fr" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.inclusions_fr || '') : ''}</textarea>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Good to Know (French) - One per line</label>
                                <textarea id="package-goodtoknow-fr" class="form-input" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;">${pkg ? (pkg.goodToKnow_fr || '') : ''}</textarea>
                            </div>
                        </div>

                        <!-- Booking Link -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Booking/Action Link (URL)</label>
                            <input type="url" id="package-booking-link" class="form-input" value="${pkg ? (pkg.bookingLink || '') : ''}" placeholder="https://example.com/booking" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                        </div>

                        <!-- Status -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Status</label>
                            <select id="package-status" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="active" ${pkg && pkg.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="inactive" ${pkg && pkg.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>

                        <!-- Action Buttons -->
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                            <button class="btn" id="cancel-package-btn">Cancel</button>
                            <button class="btn" id="save-package-btn" style="background: var(--color-sage);">Save Package</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
            packageModalOpen = true;

            // Language tab switching
            document.querySelectorAll('.package-lang-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    document.querySelectorAll('.package-lang-tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    document.querySelectorAll('.package-lang-content').forEach(c => c.style.display = 'none');
                    document.getElementById(`package-lang-${lang}`).style.display = 'block';
                });
            });

            // Image upload
            const uploadBtn = document.getElementById('package-upload-image-btn');
            const imageInput = document.getElementById('package-image-input');
            let uploadedImageUrl = pkg ? pkg.imageUrl : null;

            uploadBtn.addEventListener('click', () => imageInput.click());
            
            imageInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }

                try {
                    const timestamp = Date.now();
                    const filename = `packages/${timestamp}-${file.name}`;
                    const fileRef = storageRef(storage, filename);
                    
                    await uploadBytes(fileRef, file);
                    uploadedImageUrl = await getDownloadURL(fileRef);
                    
                    document.getElementById('package-image-preview').innerHTML = 
                        `<img src="${uploadedImageUrl}" style="max-width: 300px; border-radius: 8px;">`;
                    
                    alert('Image uploaded successfully!');
                } catch (error) {
                    console.error('Error uploading image:', error);
                    alert('Failed to upload image.');
                }
            });

            // Save package
            document.getElementById('save-package-btn').addEventListener('click', async () => {
                const packageData = {
                    imageUrl: uploadedImageUrl,
                    title_en: document.getElementById('package-title-en').value,
                    title_nl: document.getElementById('package-title-nl').value,
                    title_fr: document.getElementById('package-title-fr').value,
                    description_en: document.getElementById('package-description-en').value,
                    description_nl: document.getElementById('package-description-nl').value,
                    description_fr: document.getElementById('package-description-fr').value,
                    inclusions_en: document.getElementById('package-inclusions-en').value,
                    inclusions_nl: document.getElementById('package-inclusions-nl').value,
                    inclusions_fr: document.getElementById('package-inclusions-fr').value,
                    goodToKnow_en: document.getElementById('package-goodtoknow-en').value,
                    goodToKnow_nl: document.getElementById('package-goodtoknow-nl').value,
                    goodToKnow_fr: document.getElementById('package-goodtoknow-fr').value,
                    bookingLink: document.getElementById('package-booking-link').value,
                    status: document.getElementById('package-status').value
                };

                if (!packageData.title_en) {
                    alert('Please enter at least an English title');
                    return;
                }

                try {
                    if (editingPackageId) {
                        const pkgIndex = packagesData.findIndex(p => p.id === editingPackageId);
                        packagesData[pkgIndex] = { id: editingPackageId, ...packageData };
                    } else {
                        const newId = 'pkg_' + Date.now();
                        packagesData.push({ id: newId, ...packageData });
                    }

                    await savePackagesData();
                    alert('Package saved successfully!');
                    closePackageModal();
                    renderPackagesList();
                } catch (error) {
                    console.error('Error saving package:', error);
                    alert('Failed to save package. Please try again.');
                }
            });

            // Cancel
            document.getElementById('cancel-package-btn').addEventListener('click', closePackageModal);
            
            // Click outside to close
            document.getElementById('package-modal').addEventListener('click', (e) => {
                if (e.target.id === 'package-modal') {
                    closePackageModal();
                }
            });
        }

        // Close package modal
        function closePackageModal() {
            const modal = document.getElementById('package-modal');
            if (modal) {
                modal.remove();
            }
            packageModalOpen = false;
            editingPackageId = null;
        }

        // Delete package
        async function deletePackage(packageId) {
            if (!confirm('Are you sure you want to delete this package?')) {
                return;
            }

            try {
                packagesData = packagesData.filter(p => p.id !== packageId);
                await savePackagesData();
                renderPackagesList();
                alert('Package deleted successfully!');
            } catch (error) {
                console.error('Error deleting package:', error);
                alert('Failed to delete package.');
            }
        }

        // Toggle package status
        async function togglePackageStatus(packageId) {
            try {
                const pkg = packagesData.find(p => p.id === packageId);
                pkg.status = pkg.status === 'active' ? 'inactive' : 'active';
                await savePackagesData();
                renderPackagesList();
            } catch (error) {
                console.error('Error toggling status:', error);
                alert('Failed to update status.');
            }
        }

        // Package tab switching
        document.querySelectorAll('.package-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                currentPackageStatus = e.target.dataset.status;
                document.querySelectorAll('.package-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                renderPackagesList();
            });
        });

        // Add new package button
        document.getElementById('add-package-btn').addEventListener('click', () => {
            openPackageModal();
        });

        // ============ ROOM MANAGEMENT ============
        let roomsData = [];
        let roomModalOpen = false;

        // Sanitize filename for Firebase Storage
        function sanitizeFilename(filename) {
            // Extract the file extension
            const lastDotIndex = filename.lastIndexOf('.');
            const name = lastDotIndex > 0 ? filename.substring(0, lastDotIndex) : filename;
            const ext = lastDotIndex > 0 ? filename.substring(lastDotIndex) : '';
            
            // Remove path separators and other potentially problematic characters from name
            const sanitizedName = name.replace(/[^a-zA-Z0-9_-]/g, '_');
            // Only allow alphanumeric and underscore in extension
            const sanitizedExt = ext.replace(/[^a-zA-Z0-9.]/g, '');
            
            return sanitizedName + sanitizedExt;
        }

        async function loadRoomsData() {
            try {
                const roomsSnapshot = await get(dbRef(database, 'rooms'));
                if (roomsSnapshot.exists()) {
                    const roomsObj = roomsSnapshot.val();
                    roomsData = Object.keys(roomsObj).map(id => ({
                        id,
                        ...roomsObj[id]
                    }));
                } else {
                    roomsData = [];
                }
            } catch (error) {
                console.error('Error loading rooms:', error);
                alert('Failed to load rooms data.');
            }
        }

        function renderRoomsList() {
            const container = document.getElementById('room-list-container');
            if (!roomsData || roomsData.length === 0) {
                container.innerHTML = '<p style="color: var(--color-sage); text-align: center; margin: 2rem 0;">No rooms available. Click "Add New Room" to create one.</p>';
                attachRoomButtonListeners();
                return;
            }

            const roomsHTML = roomsData.map(room => {
                const escapedId = escapeHtml(room.id);
                const escapedName = escapeHtml(room.name_en || 'Untitled Room');
                const escapedBedType = escapeHtml(room.bedType_en || 'N/A');
                
                return `
                <div class="room-item" style="border: 1px solid var(--color-sage); border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 0.5rem 0;">${escapedName}</h3>
                            <p style="color: var(--color-sage); margin: 0.25rem 0;"><strong>Bed Type:</strong> ${escapedBedType}</p>
                            <p style="color: var(--color-sage); margin: 0.25rem 0;"><strong>Max Occupancy:</strong> ${room.maxOccupancy || 'N/A'} guests</p>
                            <p style="color: var(--color-sage); margin: 0.25rem 0;"><strong>Room Size:</strong> ${room.roomSize || 'N/A'} mÂ²</p>
                            <p style="color: var(--color-sage); margin: 0.25rem 0;"><strong>Photos:</strong> ${room.photos ? room.photos.length : 0}</p>
                            ${room.video ? '<p style="color: var(--color-sage); margin: 0.25rem 0;"><strong>Video:</strong> Yes</p>' : ''}
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn" onclick="editRoom('${escapedId}')" style="padding: 0.5rem 1rem;">Edit</button>
                            <button class="btn" onclick="deleteRoom('${escapedId}')" style="background: #d32f2f; padding: 0.5rem 1rem;">Delete</button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            container.innerHTML = roomsHTML;
            attachRoomButtonListeners();
        }

        // Add event listener for "Add New Room" button
        // Must be attached after room management card is visible
        function attachRoomButtonListeners() {
            const addRoomBtn = document.getElementById('add-new-room-btn');
            if (addRoomBtn && !addRoomBtn.hasAttribute('data-listener-attached')) {
                addRoomBtn.addEventListener('click', () => {
                    openRoomModal();
                });
                addRoomBtn.setAttribute('data-listener-attached', 'true');
            }
        }

        async function openRoomModal(roomId = null) {
            if (roomModalOpen) return;

            const room = roomId ? roomsData.find(r => r.id === roomId) : null;
            
            // Load amenities for selection
            const amenitiesSnapshot = await get(dbRef(database, 'amenitiesMaster'));
            let amenitiesList = [];
            if (amenitiesSnapshot.exists()) {
                const amenitiesObj = amenitiesSnapshot.val();
                amenitiesList = Object.keys(amenitiesObj).map(id => ({
                    id,
                    ...amenitiesObj[id]
                }));
            }

            const modalHTML = `
                <div id="room-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center; overflow-y: auto;">
                    <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 2rem;">
                        <h2>${roomId ? 'Edit Room' : 'Add New Room'}</h2>
                        
                        <!-- Language Tabs -->
                        <div class="room-lang-tabs" style="margin: 1rem 0; display: flex; gap: 0.5rem;">
                            <button class="room-lang-tab active" data-lang="en">ðŸ‡¬ðŸ‡§ EN</button>
                            <button class="room-lang-tab" data-lang="nl">ðŸ‡³ðŸ‡± NL</button>
                            <button class="room-lang-tab" data-lang="fr">ðŸ‡«ðŸ‡· FR</button>
                        </div>

                        <!-- Multi-language fields -->
                        <div id="room-lang-en" class="room-lang-content">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Name (English) *</label>
                                <input type="text" id="room-name-en" class="form-input" value="${room ? (room.name_en || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Bed Type (English) *</label>
                                <input type="text" id="room-bedtype-en" class="form-input" value="${room ? (room.bedType_en || '') : ''}" placeholder="e.g., King Size Bed" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (English)</label>
                                <textarea id="room-description-en" class="admin-textarea">${room ? (room.description_en || '') : ''}</textarea>
                            </div>
                        </div>

                        <div id="room-lang-nl" class="room-lang-content" style="display: none;">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Name (Dutch) *</label>
                                <input type="text" id="room-name-nl" class="form-input" value="${room ? (room.name_nl || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Bed Type (Dutch) *</label>
                                <input type="text" id="room-bedtype-nl" class="form-input" value="${room ? (room.bedType_nl || '') : ''}" placeholder="e.g., Kingsize Bed" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (Dutch)</label>
                                <textarea id="room-description-nl" class="admin-textarea">${room ? (room.description_nl || '') : ''}</textarea>
                            </div>
                        </div>

                        <div id="room-lang-fr" class="room-lang-content" style="display: none;">
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Name (French) *</label>
                                <input type="text" id="room-name-fr" class="form-input" value="${room ? (room.name_fr || '') : ''}" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Bed Type (French) *</label>
                                <input type="text" id="room-bedtype-fr" class="form-input" value="${room ? (room.bedType_fr || '') : ''}" placeholder="e.g., Lit King Size" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div style="margin: 1rem 0;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (French)</label>
                                <textarea id="room-description-fr" class="admin-textarea">${room ? (room.description_fr || '') : ''}</textarea>
                            </div>
                        </div>

                        <!-- Numeric Fields -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Max Occupancy *</label>
                                <input type="number" id="room-max-occupancy" class="form-input" value="${room ? (room.maxOccupancy || '') : ''}" min="1" placeholder="e.g., 2" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Size (mÂ²) *</label>
                                <input type="number" id="room-size" class="form-input" value="${room ? (room.roomSize || '') : ''}" min="1" placeholder="e.g., 25" style="width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                        </div>

                        <!-- Amenities Selection -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Amenities</label>
                            <div id="room-amenities-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.5rem; max-height: 200px; overflow-y: auto; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                                ${amenitiesList.map(amenity => {
                                    const isChecked = room && room.amenities && room.amenities[amenity.id];
                                    return `
                                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                                            <input type="checkbox" value="${amenity.id}" ${isChecked ? 'checked' : ''} style="cursor: pointer;">
                                            <span>${amenity.name_en || amenity.name_nl || amenity.name_fr}</span>
                                        </label>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <!-- Photo Gallery -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Photos</label>
                            <input type="file" id="room-photo-input" accept="image/*" multiple style="display: none;">
                            <button class="btn" id="room-upload-photo-btn">Upload Photos</button>
                            <p style="color: var(--color-sage); font-size: 0.9rem; margin-top: 0.5rem;">Drag photos to reorder them</p>
                            <div id="room-photo-gallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                ${room && room.photos ? room.photos.map((photo, index) => `
                                    <div class="room-photo-item" data-index="${index}" draggable="true" style="position: relative; cursor: move; border: 2px solid var(--color-sage); border-radius: 4px; overflow: hidden;">
                                        <img src="${photo.url}" style="width: 100%; height: 150px; object-fit: cover;">
                                        <button class="btn-delete-photo" data-index="${index}" style="position: absolute; top: 5px; right: 5px; background: #d32f2f; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; padding: 0;">Ã—</button>
                                    </div>
                                `).join('') : ''}
                            </div>
                        </div>

                        <!-- Video Upload -->
                        <div style="margin: 1rem 0;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Room Video (Optional)</label>
                            <input type="file" id="room-video-input" accept="video/*" style="display: none;">
                            <button class="btn" id="room-upload-video-btn">Upload Video</button>
                            <div id="room-video-preview" style="margin-top: 1rem;">
                                ${room && room.video ? `
                                    <div style="position: relative; display: inline-block;">
                                        <video src="${room.video.url}" controls style="max-width: 300px; border-radius: 8px;"></video>
                                        <button class="btn" id="room-delete-video-btn" style="background: #d32f2f; margin-top: 0.5rem;">Delete Video</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                            <button class="btn" id="cancel-room-btn">Cancel</button>
                            <button class="btn" id="save-room-btn" style="background: var(--color-sage);">Save Room</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
            roomModalOpen = true;

            // Language tab switching
            document.querySelectorAll('.room-lang-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    document.querySelectorAll('.room-lang-tab').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    document.querySelectorAll('.room-lang-content').forEach(c => c.style.display = 'none');
                    document.getElementById(`room-lang-${lang}`).style.display = 'block';
                });
            });

            // Photo upload and management
            let roomPhotos = room && room.photos ? [...room.photos] : [];
            
            const uploadPhotoBtn = document.getElementById('room-upload-photo-btn');
            const photoInput = document.getElementById('room-photo-input');
            
            uploadPhotoBtn.addEventListener('click', () => photoInput.click());
            
            photoInput.addEventListener('change', async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                uploadPhotoBtn.disabled = true;
                uploadPhotoBtn.textContent = 'Uploading...';

                try {
                    for (const file of files) {
                        const timestamp = Date.now();
                        const sanitizedName = sanitizeFilename(file.name);
                        const filename = `room-photos/${timestamp}-${sanitizedName}`;
                        const fileRef = storageRef(storage, filename);
                        await uploadBytes(fileRef, file);
                        const downloadURL = await getDownloadURL(fileRef);
                        
                        roomPhotos.push({
                            url: downloadURL,
                            filename: filename,
                            order: roomPhotos.length
                        });
                    }
                    
                    renderPhotoGallery();
                    e.target.value = '';
                } catch (error) {
                    console.error('Error uploading photos:', error);
                    alert('Failed to upload photos.');
                } finally {
                    uploadPhotoBtn.disabled = false;
                    uploadPhotoBtn.textContent = 'Upload Photos';
                }
            });

            function renderPhotoGallery() {
                const gallery = document.getElementById('room-photo-gallery');
                gallery.innerHTML = roomPhotos.map((photo, index) => `
                    <div class="room-photo-item" data-index="${index}" draggable="true" style="position: relative; cursor: move; border: 2px solid var(--color-sage); border-radius: 4px; overflow: hidden;">
                        <img src="${photo.url}" style="width: 100%; height: 150px; object-fit: cover;">
                        <button class="btn-delete-photo" data-index="${index}" style="position: absolute; top: 5px; right: 5px; background: #d32f2f; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; padding: 0;">Ã—</button>
                    </div>
                `).join('');

                // Add delete handlers
                gallery.querySelectorAll('.btn-delete-photo').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const index = parseInt(e.target.dataset.index);
                        const photo = roomPhotos[index];
                        
                        if (confirm('Delete this photo?')) {
                            try {
                                await deleteObject(storageRef(storage, photo.filename));
                                roomPhotos.splice(index, 1);
                                renderPhotoGallery();
                            } catch (error) {
                                console.error('Error deleting photo:', error);
                                alert('Failed to delete photo.');
                            }
                        }
                    });
                });

                // Add drag and drop handlers
                const photoItems = gallery.querySelectorAll('.room-photo-item');
                let draggedItem = null;

                photoItems.forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggedItem = item;
                        e.dataTransfer.effectAllowed = 'move';
                    });

                    item.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                    });

                    item.addEventListener('drop', (e) => {
                        e.preventDefault();
                        if (draggedItem !== item) {
                            const fromIndex = parseInt(draggedItem.dataset.index);
                            const toIndex = parseInt(item.dataset.index);
                            
                            const [movedPhoto] = roomPhotos.splice(fromIndex, 1);
                            roomPhotos.splice(toIndex, 0, movedPhoto);
                            
                            renderPhotoGallery();
                        }
                    });
                });
            }

            renderPhotoGallery();

            // Video upload
            let roomVideo = room && room.video ? room.video : null;
            
            const uploadVideoBtn = document.getElementById('room-upload-video-btn');
            const videoInput = document.getElementById('room-video-input');
            const videoPreview = document.getElementById('room-video-preview');
            
            uploadVideoBtn.addEventListener('click', () => videoInput.click());
            
            videoInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!file.type.startsWith('video/')) {
                    alert('Please select a video file');
                    return;
                }

                uploadVideoBtn.disabled = true;
                uploadVideoBtn.textContent = 'Uploading...';

                try {
                    const timestamp = Date.now();
                    const sanitizedName = sanitizeFilename(file.name);
                    const filename = `room-videos/${timestamp}-${sanitizedName}`;
                    const fileRef = storageRef(storage, filename);
                    await uploadBytes(fileRef, file);
                    const downloadURL = await getDownloadURL(fileRef);
                    
                    roomVideo = {
                        url: downloadURL,
                        filename: filename
                    };
                    
                    videoPreview.innerHTML = `
                        <div style="position: relative; display: inline-block;">
                            <video src="${roomVideo.url}" controls style="max-width: 300px; border-radius: 8px;"></video>
                            <button class="btn" id="room-delete-video-btn" style="background: #d32f2f; margin-top: 0.5rem;">Delete Video</button>
                        </div>
                    `;
                    
                    document.getElementById('room-delete-video-btn').addEventListener('click', async () => {
                        if (confirm('Delete this video?')) {
                            try {
                                await deleteObject(storageRef(storage, roomVideo.filename));
                                roomVideo = null;
                                videoPreview.innerHTML = '';
                            } catch (error) {
                                console.error('Error deleting video:', error);
                                alert('Failed to delete video.');
                            }
                        }
                    });
                    
                    e.target.value = '';
                } catch (error) {
                    console.error('Error uploading video:', error);
                    alert('Failed to upload video.');
                } finally {
                    uploadVideoBtn.disabled = false;
                    uploadVideoBtn.textContent = 'Upload Video';
                }
            });

            // Delete video handler for existing video
            if (room && room.video) {
                document.getElementById('room-delete-video-btn')?.addEventListener('click', async () => {
                    if (confirm('Delete this video?')) {
                        try {
                            await deleteObject(storageRef(storage, roomVideo.filename));
                            roomVideo = null;
                            videoPreview.innerHTML = '';
                        } catch (error) {
                            console.error('Error deleting video:', error);
                            alert('Failed to delete video.');
                        }
                    }
                });
            }

            // Close modal on background click
            document.getElementById('room-modal').addEventListener('click', (e) => {
                if (e.target.id === 'room-modal') {
                    closeRoomModal();
                }
            });

            // Cancel button
            document.getElementById('cancel-room-btn').addEventListener('click', closeRoomModal);

            // Save button
            document.getElementById('save-room-btn').addEventListener('click', async () => {
                const name_en = document.getElementById('room-name-en').value.trim();
                const name_nl = document.getElementById('room-name-nl').value.trim();
                const name_fr = document.getElementById('room-name-fr').value.trim();
                const bedType_en = document.getElementById('room-bedtype-en').value.trim();
                const bedType_nl = document.getElementById('room-bedtype-nl').value.trim();
                const bedType_fr = document.getElementById('room-bedtype-fr').value.trim();
                const description_en = document.getElementById('room-description-en').value.trim();
                const description_nl = document.getElementById('room-description-nl').value.trim();
                const description_fr = document.getElementById('room-description-fr').value.trim();
                const maxOccupancy = parseInt(document.getElementById('room-max-occupancy').value);
                const roomSize = parseFloat(document.getElementById('room-size').value);

                // Validation
                if (!name_en || !name_nl || !name_fr) {
                    alert('Please fill in room name for all languages');
                    return;
                }
                if (!bedType_en || !bedType_nl || !bedType_fr) {
                    alert('Please fill in bed type for all languages');
                    return;
                }
                if (!maxOccupancy || maxOccupancy < 1) {
                    alert('Please enter a valid max occupancy');
                    return;
                }
                if (!roomSize || roomSize < 1) {
                    alert('Please enter a valid room size');
                    return;
                }

                // Collect selected amenities
                const amenities = {};
                document.querySelectorAll('#room-amenities-list input[type="checkbox"]:checked').forEach(checkbox => {
                    amenities[checkbox.value] = true;
                });

                const roomData = {
                    name_en,
                    name_nl,
                    name_fr,
                    bedType_en,
                    bedType_nl,
                    bedType_fr,
                    description_en,
                    description_nl,
                    description_fr,
                    maxOccupancy,
                    roomSize,
                    amenities,
                    photos: roomPhotos,
                    ...(roomVideo && { video: roomVideo })
                };

                const saveBtn = document.getElementById('save-room-btn');
                saveBtn.disabled = true;
                saveBtn.textContent = 'Saving...';

                try {
                    const id = roomId || `room_${Date.now()}`;
                    await set(dbRef(database, `rooms/${id}`), roomData);
                    
                    await loadRoomsData();
                    renderRoomsList();
                    closeRoomModal();
                } catch (error) {
                    console.error('Error saving room:', error);
                    alert('Failed to save room.');
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'Save Room';
                }
            });

            function closeRoomModal() {
                document.getElementById('room-modal')?.remove();
                roomModalOpen = false;
            }
        }

        window.editRoom = function(roomId) {
            openRoomModal(roomId);
        };

        window.deleteRoom = async function(roomId) {
            if (!confirm('Are you sure you want to delete this room?')) return;

            try {
                const room = roomsData.find(r => r.id === roomId);
                
                // Delete photos from storage
                if (room.photos) {
                    for (const photo of room.photos) {
                        try {
                            await deleteObject(storageRef(storage, photo.filename));
                        } catch (error) {
                            console.error('Error deleting photo:', error);
                        }
                    }
                }
                
                // Delete video from storage
                if (room.video) {
                    try {
                        await deleteObject(storageRef(storage, room.video.filename));
                    } catch (error) {
                        console.error('Error deleting video:', error);
                    }
                }
                
                // Delete room from database
                await remove(dbRef(database, `rooms/${roomId}`));
                
                await loadRoomsData();
                renderRoomsList();
            } catch (error) {
                console.error('Error deleting room:', error);
                alert('Failed to delete room.');
            }
        };

    </script>
</body>
</html>
